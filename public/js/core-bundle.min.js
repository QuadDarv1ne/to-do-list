if(function(){"use strict";window.appInit=new class{constructor(){this.modules=new Map,this.initialized=!1}register(e,t,n={}){this.modules.set(e,{init:t,priority:n.priority||10,condition:n.condition||(()=>!0),initialized:!1})}async init(){if(this.initialized)return;const e=Array.from(this.modules.entries()).sort((e,t)=>e[1].priority-t[1].priority);for(const[t,n]of e)if(n.condition()&&!n.initialized)try{await n.init(),n.initialized=!0}catch(e){console.error(`Failed to initialize module: ${t}`,e)}this.initialized=!0}isInitialized(e){const t=this.modules.get(e);return!!t&&t.initialized}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.appInit.init()}):window.appInit.init()}(),window.showToast=function(e,t="info"){let n=document.getElementById("toast-container");n||(n=document.createElement("div"),n.id="toast-container",n.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 9999;",document.body.appendChild(n));const o=document.createElement("div");o.className=`alert alert-${t} alert-dismissible fade show`,o.style.cssText="margin-bottom: 10px; min-width: 300px;";const i=document.createElement("span");i.textContent=e,o.appendChild(i);const a=document.createElement("button");a.type="button",a.className="btn-close",a.onclick=function(){this.parentElement.remove()},o.appendChild(a),n.appendChild(o),setTimeout(()=>{o.parentElement&&o.remove()},5e3)},window.showNotification=function(e,t,n="info"){"Notification"in window&&"granted"===Notification.permission?new Notification(e,{body:t,icon:"/icon.png",badge:"/icon.png"}):"function"==typeof window.showToast&&window.showToast(`${e}: ${t}`,n)},window.fetchJSON=async function(e,t={}){try{const n=await fetch(e,{headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",...t.headers},...t});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return await n.json()}catch(e){throw console.error("Fetch error:",e),window.showToast("Ошибка загрузки данных","danger"),e}},window.validateForm=function(e){const t=e.querySelectorAll("input[required], textarea[required], select[required]");let n=!0;return t.forEach(e=>{e.value.trim()?e.classList.remove("is-invalid"):(e.classList.add("is-invalid"),n=!1)}),n},window.debounce=function(e,t=300){let n;return function(...o){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...o)},t)}},window.throttle=function(e,t=300){let n;return function(...o){n||(e.apply(this,o),n=!0,setTimeout(()=>n=!1,t))}},window.storage={set:(e,t)=>{try{return localStorage.setItem(e,JSON.stringify(t)),!0}catch(e){return console.error("Storage error:",e),!1}},get:(e,t=null)=>{try{const n=localStorage.getItem(e);return n?JSON.parse(n):t}catch(e){return console.error("Storage error:",e),t}},remove:e=>{try{return localStorage.removeItem(e),!0}catch(e){return console.error("Storage error:",e),!1}},clear:()=>{try{return localStorage.clear(),!0}catch(e){return console.error("Storage error:",e),!1}}},window.formatDate=function(e,t="short"){const n=new Date(e);return"short"===t?n.toLocaleDateString("ru-RU"):"long"===t?n.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}):"time"===t?n.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}):"datetime"===t?`${n.toLocaleDateString("ru-RU")} ${n.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`:n.toLocaleDateString("ru-RU")},window.confirmAction=function(e,t){confirm(e)&&t()},window.showLoading=function(e){e&&(e.classList.add("loading"),e.style.pointerEvents="none",e.style.opacity="0.6")},window.hideLoading=function(e){e&&(e.classList.remove("loading"),e.style.pointerEvents="",e.style.opacity="")},window.copyToClipboard=function(e){if(navigator.clipboard)navigator.clipboard.writeText(e).then(()=>{window.showToast("Скопировано в буфер обмена","success")}).catch(()=>{window.showToast("Ошибка копирования","danger")});else{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{document.execCommand("copy"),window.showToast("Скопировано в буфер обмена","success")}catch(e){window.showToast("Ошибка копирования","danger")}document.body.removeChild(t)}},window.escapeHtml=function(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML},window.getQueryParam=function(e){return new URLSearchParams(window.location.search).get(e)},window.scrollToElement=function(e,t=0){if(!e)return;const n=e.getBoundingClientRect().top+window.pageYOffset-t;window.scrollTo({top:n,behavior:"smooth"})},window.isInViewport=function(e){if(!e)return!1;const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},document.addEventListener("DOMContentLoaded",()=>{}),function(){"use strict";function e(e,t){let n;return function(...o){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...o)},t)}}function t(t,n={}){const{debounceDelay:o=300,autoSubmit:i=!1,formSelector:a=null,onSearch:r=null,containerSelector:s=null}=n;if(!t)return;const c=s?document.querySelector(s):t.parentElement;let d=!1;const l=e(e=>{if(function(e){const t=new URL(window.location.href);e&&""!==e.trim()?t.searchParams.set("search",e.trim()):t.searchParams.delete("search"),window.history.replaceState({},"",t)}(e),function(e){if(!e)return;e.style.opacity="0.5",e.style.pointerEvents="none";let t=e.querySelector(".search-loading-indicator");t||(t=document.createElement("div"),t.className="search-loading-indicator",t.innerHTML='\n                <div class="spinner-border spinner-border-sm text-primary" role="status">\n                    <span class="visually-hidden">Загрузка...</span>\n                </div>\n            ',t.style.cssText="position: absolute; right: 1rem; top: 50%; transform: translateY(-50%);",e.style.position="relative",e.appendChild(t))}(c),i&&a){const e=document.querySelector(a);e&&e.requestSubmit()}else r&&"function"==typeof r?r(e):setTimeout(()=>{!function(e){if(!e)return;e.style.opacity="1",e.style.pointerEvents="auto";const t=e.querySelector(".search-loading-indicator");t&&t.remove()}(c)},500);window.dispatchEvent(new CustomEvent("debounced-search",{detail:{query:e}}))},o);t.addEventListener("input",e=>{d||l(e.target.value)}),t.addEventListener("compositionstart",()=>{d=!0}),t.addEventListener("compositionend",e=>{d=!1,l(e.target.value)});const u=t.parentElement?.querySelector(".search-clear-btn");u&&u.addEventListener("click",()=>{t.value="",l(""),t.focus()}),t.addEventListener("keydown",e=>{"Escape"===e.key&&(t.value="",l(""),t.blur()),"Enter"===e.key&&l.flush?.()})}function n(){document.querySelectorAll('input[data-debounce-search="true"], input.debounce-search').forEach(e=>{t(e,{debounceDelay:parseInt(e.dataset.debounceDelay)||300,autoSubmit:"true"===e.dataset.debounceAutoSubmit,formSelector:e.dataset.debounceForm})});const e=document.querySelector('input[name="search"]');e&&!e.classList.contains("debounce-search-initialized")&&(e.classList.add("debounce-search-initialized"),t(e,{debounceDelay:300,autoSubmit:!0,formSelector:e.closest("form")?.querySelector("form")||e.closest("form"),containerSelector:e.closest(".card-body")}));const n=document.querySelector('input[name="quick_search"], input#quick-search');n&&!n.classList.contains("debounce-search-initialized")&&(n.classList.add("debounce-search-initialized"),t(n,{debounceDelay:200,onSearch:function(e){console.log("Quick search:",e)}}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n(),document.addEventListener("turbo:load",n),document.addEventListener("turbo:frame-load",n),window.DebouncedSearch={init:t,debounce:e}}(),function(){"use strict";function e(e){const n=e.value.trim();let o=!0,i="";return e.hasAttribute("required")&&!n?(o=!1,i="Это поле обязательно для заполнения"):"email"===e.type&&n&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)?(o=!1,i="Введите корректный email адрес"):"url"===e.type&&n&&!function(e){try{return new URL(e),!0}catch{return!1}}(n)?(o=!1,i="Введите корректный URL"):e.hasAttribute("minlength")&&n.length<e.getAttribute("minlength")&&(o=!1,i=`Минимальная длина: ${e.getAttribute("minlength")} символов`),o?(e.classList.remove("is-invalid"),e.classList.add("is-valid"),t(e)):(e.classList.remove("is-valid"),e.classList.add("is-invalid"),function(e,n){t(e);const o=document.createElement("div");o.className="invalid-feedback",o.textContent=n,e.parentNode.appendChild(o)}(e,i)),o}function t(e){const t=e.parentNode.querySelector(".invalid-feedback");t&&t.remove()}function n(){let e=document.getElementById("global-loading-indicator");e||(e=document.createElement("div"),e.id="global-loading-indicator",e.className="position-fixed top-0 start-0 w-100 bg-primary",e.style.height="3px",e.style.zIndex="9999",e.innerHTML='<div class="progress-bar progress-bar-striped progress-bar-animated w-100"></div>',document.body.appendChild(e)),e.style.display="block"}function o(){const e=document.getElementById("global-loading-indicator");e&&(e.style.display="none")}function i(e,t="info"){let n=document.getElementById("auto-save-indicator");n||(n=document.createElement("div"),n.id="auto-save-indicator",n.className="position-fixed bottom-0 end-0 m-3 p-3 rounded shadow",n.style.zIndex="9999",document.body.appendChild(n)),n.className=`position-fixed bottom-0 end-0 m-3 p-3 rounded shadow bg-${"success"===t?"success":"error"===t?"danger":"info"} text-white`,n.innerHTML=`<i class="fas fa-${"success"===t?"check":"error"===t?"times":"spinner fa-spin"} me-2"></i>${function(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}(e)}`,n.style.display="block","info"!==t&&setTimeout(()=>{n.style.display="none"},3e3)}document.addEventListener("DOMContentLoaded",function(){[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e,{delay:{show:500,hide:100}})}),[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map(function(e){return new bootstrap.Popover(e)}),function(){document.querySelectorAll("form[data-validate]").forEach(t=>{t.querySelectorAll("input, textarea, select").forEach(t=>{t.addEventListener("blur",function(){e(this)}),t.addEventListener("input",function(){this.classList.contains("is-invalid")&&e(this)})})});document.querySelectorAll("textarea[maxlength]").forEach(e=>{const t=e.getAttribute("maxlength"),n=document.createElement("small");n.className="form-text text-muted",n.textContent=`0 / ${t}`,e.parentNode.appendChild(n),e.addEventListener("input",function(){const e=this.value.length;n.textContent=`${e} / ${t}`,n.className=e>.9*t?"form-text text-warning":"form-text text-muted"})});document.querySelectorAll("textarea[data-auto-resize]").forEach(e=>{e.style.overflow="hidden",e.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"})});document.querySelectorAll('input[type="password"][data-strength]').forEach(e=>{const t=document.createElement("div");t.className="password-strength-bar mt-2",t.innerHTML='<div class="password-strength-progress"></div>',e.parentNode.appendChild(t),e.addEventListener("input",function(){const e=function(e){let t=0;e.length>=8&&t++;e.length>=12&&t++;/[a-z]/.test(e)&&/[A-Z]/.test(e)&&t++;/\d/.test(e)&&t++;/[^a-zA-Z0-9]/.test(e)&&t++;return t}(this.value);!function(e,t){const n=e.querySelector(".password-strength-progress"),o=t/5*100;n.style.width=o+"%",n.className="password-strength-progress",t<=2?n.classList.add("bg-danger"):t<=3?n.classList.add("bg-warning"):n.classList.add("bg-success")}(t,e)})})}(),function(){document.querySelectorAll("table[data-sortable]").forEach(e=>{e.querySelectorAll("th[data-sort]").forEach(t=>{t.style.cursor="pointer",t.addEventListener("click",function(){sortTable(e,this)})})});document.querySelectorAll("table tbody tr").forEach(e=>{e.addEventListener("mouseenter",function(){this.style.transform="scale(1.01)"}),e.addEventListener("mouseleave",function(){this.style.transform="scale(1)"})})}(),function(){const e=document.querySelectorAll(".card"),t=new IntersectionObserver(e=>{e.forEach((e,n)=>{e.isIntersecting&&(setTimeout(()=>{e.target.classList.add("fade-in-up")},100*n),t.unobserve(e.target))})},{threshold:.1});e.forEach(e=>{t.observe(e)})}(),function(){const e=document.getElementById("select-all-tasks"),t=document.querySelectorAll(".task-checkbox"),n=document.getElementById("bulk-actions-container"),o=document.getElementById("selected-count"),i=document.getElementById("cancel-bulk-selection"),a=document.getElementById("bulk-action-select"),r=document.getElementById("tag-selection-container");e&&e.addEventListener("change",function(){t.forEach(e=>{e.checked=this.checked}),s()});t.forEach(e=>{e.addEventListener("change",s)}),i&&i.addEventListener("click",function(){t.forEach(e=>e.checked=!1),e&&(e.checked=!1),s()});a&&a.addEventListener("change",function(){"assign_tag"===this.value&&r?r.style.display="block":r&&(r.style.display="none")});function s(){const e=document.querySelectorAll(".task-checkbox:checked").length;e>0?(n?.classList.remove("d-none"),o&&(o.textContent=`Выбрано: ${e}`)):n?.classList.add("d-none")}}(),document.querySelectorAll('input[type="search"], input[name="search"]').forEach(e=>{let t;e.addEventListener("input",function(){clearTimeout(t);const e=this.parentNode.querySelector("i");e&&(e.className="fas fa-spinner fa-spin"),t=setTimeout(()=>{e&&(e.className="fas fa-search")},500)})}),document.querySelectorAll("form").forEach(e=>{e.addEventListener("submit",function(e){const t=this.querySelector('button[type="submit"]');if(t&&!t.disabled){t.disabled=!0;const e=t.innerHTML;t.innerHTML='<i class="fas fa-spinner fa-spin me-2"></i>Загрузка...',setTimeout(()=>{t.disabled=!1,t.innerHTML=e},5e3)}})}),document.addEventListener("ajaxStart",function(){n()}),document.addEventListener("ajaxComplete",function(){o()}),document.querySelectorAll("a[data-confirm], button[data-confirm]").forEach(e=>{e.addEventListener("click",function(e){const t=this.getAttribute("data-confirm")||"Вы уверены?";if(!confirm(t))return e.preventDefault(),!1})}),document.querySelectorAll("form[data-auto-save]").forEach(e=>{let t;e.querySelectorAll("input, textarea, select").forEach(n=>{n.addEventListener("input",function(){clearTimeout(t),i("Сохранение..."),t=setTimeout(()=>{!function(e){const t=new FormData(e),n=e.getAttribute("data-auto-save-url")||e.action;fetch(n,{method:"POST",body:t,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{e.success?i("Сохранено","success"):i("Ошибка сохранения","error")}).catch(()=>{i("Ошибка сохранения","error")})}(e)},2e3)})})}),document.addEventListener("keydown",function(e){if((e.ctrlKey||e.metaKey)&&"k"===e.key){e.preventDefault();const t=document.querySelector('input[name="search"]');t&&(t.focus(),t.select())}if((e.ctrlKey||e.metaKey)&&"s"===e.key){const t=document.querySelector("form");t&&(e.preventDefault(),t.requestSubmit())}})}),window.TaskManagerUI={showToast:function(e,t="info"){"function"==typeof window.showToast&&window.showToast(e,t)},showLoading:n,hideLoading:o,validateField:e}}(),!document.getElementById("passwordStrengthStyles")){const e=document.createElement("style");e.id="passwordStrengthStyles",e.textContent="\n    .password-strength-bar {\n        height: 4px;\n        background: #e9ecef;\n        border-radius: 2px;\n        overflow: hidden;\n    }\n    \n    .password-strength-progress {\n        height: 100%;\n        transition: width 0.3s ease, background-color 0.3s ease;\n    }\n    \n    #auto-save-indicator {\n        animation: slideInRight 0.3s ease-out;\n    }\n    \n    @keyframes slideInRight {\n        from {\n            transform: translateX(100%);\n            opacity: 0;\n        }\n        to {\n            transform: translateX(0);\n            opacity: 1;\n        }\n    }\n",document.head.appendChild(e)}class UIEnhancements{constructor(){this.init()}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}init(){this.initRippleEffect(),this.initAnimateOnScroll(),this.initSmoothScroll(),this.initTableSorting(),this.initTooltips(),this.initSkeletonLoading()}initRippleEffect(){document.addEventListener("click",e=>{const t=e.target.closest(".btn, .card, .list-group-item");if(!t)return;const n=document.createElement("span"),o=t.getBoundingClientRect(),i=Math.max(o.width,o.height),a=e.clientX-o.left-i/2,r=e.clientY-o.top-i/2;n.style.width=n.style.height=i+"px",n.style.left=a+"px",n.style.top=r+"px",n.classList.add("ripple"),t.classList.contains("ripple-container")||t.classList.add("ripple-container"),t.appendChild(n),setTimeout(()=>n.remove(),600)})}initAnimateOnScroll(){const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("animate-fade-in"),e.unobserve(t.target))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".card, .list-group-item, .stat-card").forEach(t=>{e.observe(t)})}initSmoothScroll(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){const t=this.getAttribute("href");if("#"===t)return;const n=document.querySelector(t);n&&(e.preventDefault(),n.scrollIntoView({behavior:"smooth",block:"start"}))})})}initTableSorting(){document.querySelectorAll(".table th.sortable").forEach(e=>{e.addEventListener("click",()=>{const t=e.closest("table"),n=t.querySelector("tbody"),o=Array.from(n.querySelectorAll("tr")),i=Array.from(e.parentElement.children).indexOf(e),a=e.classList.contains("asc");t.querySelectorAll("th").forEach(e=>{e.classList.remove("asc","desc")}),e.classList.add(a?"desc":"asc"),o.sort((e,t)=>{const n=e.children[i].textContent.trim(),o=t.children[i].textContent.trim(),r=parseFloat(n),s=parseFloat(o);return isNaN(r)||isNaN(s)?a?o.localeCompare(n):n.localeCompare(o):a?s-r:r-s}),o.forEach(e=>n.appendChild(e))})})}initTooltips(){document.querySelectorAll("[data-tooltip]").forEach(e=>{const t=document.createElement("div");t.className="tooltip-content",t.textContent=e.getAttribute("data-tooltip");const n=document.createElement("div");n.className="tooltip-wrapper",e.parentNode.insertBefore(n,e),n.appendChild(e),n.appendChild(t)})}initSkeletonLoading(){document.querySelectorAll('[data-loading="true"]').forEach(e=>{e.classList.add("skeleton")})}static animateCounter(e,t,n=1e3){const o=parseInt(e.textContent)||0,i=(t-o)/(n/16);let a=o;const r=setInterval(()=>{a+=i,i>0&&a>=t||i<0&&a<=t?(e.textContent=t.toLocaleString("ru-RU"),clearInterval(r)):e.textContent=Math.round(a).toLocaleString("ru-RU")},16)}static showLoading(e){const t=document.createElement("div");t.className="loading-spinner",t.setAttribute("data-loading-spinner","true"),e.appendChild(t),e.style.position="relative",e.style.pointerEvents="none",e.style.opacity="0.6"}static hideLoading(e){const t=e.querySelector("[data-loading-spinner]");t&&t.remove(),e.style.pointerEvents="",e.style.opacity=""}static showToast(e,t="info",n=3e3){const o=document.createElement("div");o.className=`alert alert-${t} animate-slide-in-right`,o.style.cssText="\n            position: fixed;\n            top: 80px;\n            right: 20px;\n            z-index: 9999;\n            min-width: 300px;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n        ";const i={success:"fa-check-circle",danger:"fa-exclamation-circle",warning:"fa-exclamation-triangle",info:"fa-info-circle"};o.innerHTML=`\n            <i class="fas ${i[t]||i.info} me-2"></i>\n            ${this.escapeHtml(e)}\n        `,document.body.appendChild(o),setTimeout(()=>{o.style.animation="fadeIn 0.3s ease-out reverse",setTimeout(()=>o.remove(),300)},n)}static confirm(e,t,n){const o=document.createElement("div");o.className="modal-backdrop fade show",o.style.zIndex="9998";const i=document.createElement("div");i.className="modal fade show animate-scale-in",i.style.cssText="display: block; z-index: 9999;";i.innerHTML=`\n            <div class="modal-dialog modal-dialog-centered">\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h5 class="modal-title">Подтверждение</h5>\n                    </div>\n                    <div class="modal-body">\n                        <p>${(e=>{const t=document.createElement("div");return t.textContent=e,t.innerHTML})(e)}</p>\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-secondary" data-action="cancel">Отмена</button>\n                        <button type="button" class="btn btn-primary" data-action="confirm">Подтвердить</button>\n                    </div>\n                </div>\n            </div>\n        `,document.body.appendChild(o),document.body.appendChild(i);const a=()=>{i.remove(),o.remove()};i.querySelector('[data-action="confirm"]').addEventListener("click",()=>{a(),t&&t()}),i.querySelector('[data-action="cancel"]').addEventListener("click",()=>{a(),n&&n()}),o.addEventListener("click",()=>{a(),n&&n()})}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.uiEnhancements=new UIEnhancements}):window.uiEnhancements=new UIEnhancements,window.UIEnhancements=UIEnhancements;