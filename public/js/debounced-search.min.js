!function(){"use strict";function e(e,t){let n;return function(...o){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...o)},t)}}function t(t,n={}){const{debounceDelay:o=300,autoSubmit:r=!1,formSelector:c=null,onSearch:a=null,containerSelector:i=null}=n;if(!t)return;const s=i?document.querySelector(i):t.parentElement;let u=!1;const d=e(e=>{if(function(e){const t=new URL(window.location.href);e&&""!==e.trim()?t.searchParams.set("search",e.trim()):t.searchParams.delete("search"),window.history.replaceState({},"",t)}(e),function(e){if(!e)return;e.style.opacity="0.5",e.style.pointerEvents="none";let t=e.querySelector(".search-loading-indicator");t||(t=document.createElement("div"),t.className="search-loading-indicator",t.innerHTML='\n                <div class="spinner-border spinner-border-sm text-primary" role="status">\n                    <span class="visually-hidden">Загрузка...</span>\n                </div>\n            ',t.style.cssText="position: absolute; right: 1rem; top: 50%; transform: translateY(-50%);",e.style.position="relative",e.appendChild(t))}(s),r&&c){const e=document.querySelector(c);e&&e.requestSubmit()}else a&&"function"==typeof a?a(e):setTimeout(()=>{!function(e){if(!e)return;e.style.opacity="1",e.style.pointerEvents="auto";const t=e.querySelector(".search-loading-indicator");t&&t.remove()}(s)},500);window.dispatchEvent(new CustomEvent("debounced-search",{detail:{query:e}}))},o);t.addEventListener("input",e=>{u||d(e.target.value)}),t.addEventListener("compositionstart",()=>{u=!0}),t.addEventListener("compositionend",e=>{u=!1,d(e.target.value)});const l=t.parentElement?.querySelector(".search-clear-btn");l&&l.addEventListener("click",()=>{t.value="",d(""),t.focus()}),t.addEventListener("keydown",e=>{"Escape"===e.key&&(t.value="",d(""),t.blur()),"Enter"===e.key&&d.flush?.()})}function n(){document.querySelectorAll('input[data-debounce-search="true"], input.debounce-search').forEach(e=>{t(e,{debounceDelay:parseInt(e.dataset.debounceDelay)||300,autoSubmit:"true"===e.dataset.debounceAutoSubmit,formSelector:e.dataset.debounceForm})});const e=document.querySelector('input[name="search"]');e&&!e.classList.contains("debounce-search-initialized")&&(e.classList.add("debounce-search-initialized"),t(e,{debounceDelay:300,autoSubmit:!0,formSelector:e.closest("form")?.querySelector("form")||e.closest("form"),containerSelector:e.closest(".card-body")}));const n=document.querySelector('input[name="quick_search"], input#quick-search');n&&!n.classList.contains("debounce-search-initialized")&&(n.classList.add("debounce-search-initialized"),t(n,{debounceDelay:200,onSearch:function(e){console.log("Quick search:",e)}}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n(),document.addEventListener("turbo:load",n),document.addEventListener("turbo:frame-load",n),window.DebouncedSearch={init:t,debounce:e}}();