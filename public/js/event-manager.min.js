!function(){"use strict";window.eventManager=new class{constructor(){this.listeners=new Map}addEventListener(e,t,n,r={}){if(!e)return null;const s=`${t}_${Date.now()}_${Math.random()}`,i=e=>n(e);return e.addEventListener(t,i,r),this.listeners.set(s,{element:e,event:t,handler:i,options:r}),s}removeEventListener(e){if(!this.listeners.has(e))return!1;const{element:t,event:n,handler:r,options:s}=this.listeners.get(e);return t.removeEventListener(n,r,s),this.listeners.delete(e),!0}removeAllForElement(e){let t=0;return this.listeners.forEach((n,r)=>{n.element===e&&(this.removeEventListener(r),t++)}),t}removeAll(){this.listeners.forEach((e,t)=>{this.removeEventListener(t)})}delegate(e,t,n,r){return this.addEventListener(e,n,n=>{const s=n.target.closest(t);s&&e.contains(s)&&r.call(s,n)})}once(e,t,n){const r=this.addEventListener(e,t,e=>{n(e),this.removeEventListener(r)});return r}debounce(e,t,n,r=300){let s;return this.addEventListener(e,t,e=>{clearTimeout(s),s=setTimeout(()=>n(e),r)})}throttle(e,t,n,r=300){let s=0;return this.addEventListener(e,t,e=>{const t=Date.now();t-s>=r&&(s=t,n(e))})}getStats(){const e={};return this.listeners.forEach(t=>{e[t.event]=(e[t.event]||0)+1}),{total:this.listeners.size,byEvent:e}}},window.addEventListener("beforeunload",()=>{window.eventManager.removeAll()}),"dev"===document.querySelector('meta[name="environment"]')?.content&&setInterval(()=>{const e=window.eventManager.getStats();e.total>100&&console.warn("[EventManager] Возможная утечка памяти:",e)},3e4)}();