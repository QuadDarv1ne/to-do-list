!function(){"use strict";function e(){document.querySelectorAll(".badge-editable[data-task-id]").forEach(e=>{e.addEventListener("click",s=>{s.stopPropagation(),function(e){t();const s=e.dataset.taskId,a=e.dataset.status,i=e.getBoundingClientRect(),o=document.createElement("div");o.className="inline-edit-dropdown",o.style.position="fixed",o.style.top=`${i.bottom+window.scrollY+5}px`,o.style.left=`${i.left+window.scrollX}px`;[{value:"pending",label:"В ожидании",icon:"fa-clock",color:"warning"},{value:"in_progress",label:"В процессе",icon:"fa-play-circle",color:"info"},{value:"completed",label:"Завершено",icon:"fa-check-circle",color:"success"}].forEach(t=>{const i=document.createElement("div");i.className="inline-edit-dropdown-item "+(t.value===a?"active":""),i.innerHTML=`\n                <i class="fas ${t.icon}"></i>\n                <span>${t.label}</span>\n            `,i.addEventListener("click",a=>{a.stopPropagation(),n(s,t.value,e)}),o.appendChild(i)}),document.body.appendChild(o)}(e)})}),document.addEventListener("click",()=>{t()})}function t(){document.querySelectorAll(".inline-edit-dropdown").forEach(e=>e.remove())}async function n(e,t,s){const a=s.dataset.status;try{if(!(await fetch(`/api/v1/tasks/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||""},body:JSON.stringify({status:t})})).ok)throw new Error("Failed to update status");!function(e,t){const n={pending:{class:"warning",label:"В ожидании",icon:"fa-clock"},in_progress:{class:"info",label:"В процессе",icon:"fa-play-circle"},completed:{class:"success",label:"Завершено",icon:"fa-check-circle"}}[t];e.classList.remove("bg-warning","bg-info","bg-success"),e.classList.add(`bg-${n.class}`),e.innerHTML=`\n            <i class="fas ${n.icon} me-1"></i>\n            ${n.label}\n            <i class="fas fa-chevron-down chevron"></i>\n        `}(s,t),s.dataset.status=t,function(e,t){const s=document.createElement("div");s.className="inline-edit-toast",s.innerHTML='\n            <i class="fas fa-check-circle text-success"></i>\n            <span>Статус изменён</span>\n            <button class="undo-btn">Отменить</button>\n        ',document.body.appendChild(s),s.querySelector(".undo-btn").addEventListener("click",async()=>{await n(e,t,s.closest(".inline-edit-toast").previousElementSibling),s.remove()}),setTimeout(()=>{s.style.animation="slideInRight 0.3s ease reverse",setTimeout(()=>s.remove(),300)},5e3)}(e,a),window.dispatchEvent(new CustomEvent("task-status-updated",{detail:{taskId:e,oldStatus:a,newStatus:t}}))}catch(e){console.error("Error updating task status:",e),showToast("Ошибка при обновлении статуса","error")}}const s="task_filters_saved";function a(){!function(){const e=c(),t=i(),n=e.find(e=>JSON.stringify(e.filters)===JSON.stringify(t));n&&console.log("Applied saved filter:",n.name)}(),function(){const e=document.querySelector(".card-body form.row.g-3");if(!e)return;const t=e.querySelector(".btn-group.w-100");if(!t)return;const n=document.createElement("button");n.type="button",n.className="btn btn-outline-primary",n.innerHTML='<i class="fas fa-bookmark me-1"></i>Сохранить',n.title="Сохранить текущий фильтр",n.addEventListener("click",e=>{e.preventDefault(),o()}),t.appendChild(n)}(),d()}function i(){const e=new URLSearchParams(window.location.search),t={};return["search","status","priority","category","tag","hide_completed","sort_by","sort_direction"].forEach(n=>{e.has(n)&&(t[n]=e.get(n))}),t}function o(){const e=i(),t=c(),n=t.findIndex(t=>JSON.stringify(t.filters)===JSON.stringify(e));if(-1===n){const n=prompt("Название для этого фильтра:","Мой фильтр");n&&(t.push({id:Date.now(),name:n,filters:e,created:(new Date).toISOString()}),localStorage.setItem(s,JSON.stringify(t)),d(),showToast("Фильтр сохранён","success"))}else confirm("Этот фильтр уже сохранён. Обновить?")&&(t[n].name=prompt("Название фильтра:",t[n].name),localStorage.setItem(s,JSON.stringify(t)),d(),showToast("Фильтр обновлён","success"))}function c(){try{return JSON.parse(localStorage.getItem(s))||[]}catch(e){return[]}}function r(e){const t=new URLSearchParams(window.location.search);t.delete("search"),t.delete("status"),t.delete("priority"),t.delete("category"),t.delete("tag"),t.delete("hide_completed"),t.delete("sort_by"),t.delete("sort_direction"),Object.entries(e.filters).forEach(([e,n])=>{n&&t.set(e,n)}),window.location.href=`?${t.toString()}`}function l(e){if(!confirm("Удалить этот фильтр?"))return;const t=c(),n=t.findIndex(t=>t.id===e);-1!==n&&(t.splice(n,1),localStorage.setItem(s,JSON.stringify(t)),d(),showToast("Фильтр удалён","success"))}function d(){const e=c(),t=document.querySelector(".saved-filters-container");if(t&&t.remove(),0===e.length)return;const n=document.createElement("div");n.className="saved-filters-container card border-0 shadow-sm mb-4",n.innerHTML=`\n            <div class="card-header bg-light">\n                <h5 class="mb-0">\n                    <i class="fas fa-bookmark me-2 text-primary"></i>\n                    Сохранённые фильтры\n                </h5>\n            </div>\n            <div class="card-body">\n                <div class="quick-filters">\n                    ${e.map(e=>`\n                        <div class="filter-chip" data-filter-id="${e.id}">\n                            <i class="fas fa-bookmark chip-icon"></i>\n                            <span>${e.name}</span>\n                            <button class="btn btn-sm btn-link p-0 ms-1 delete-filter" data-filter-id="${e.id}">\n                                <i class="fas fa-times"></i>\n                            </button>\n                        </div>\n                    `).join("")}\n                </div>\n            </div>\n        `,n.querySelectorAll(".filter-chip").forEach(t=>{t.addEventListener("click",n=>{if(!n.target.closest(".delete-filter")){const n=parseInt(t.dataset.filterId),s=e.find(e=>e.id===n);s&&r(s)}})}),n.querySelectorAll(".delete-filter").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();l(parseInt(e.dataset.filterId))})});const s=document.querySelector(".card-body form.row.g-3")?.closest(".card");s&&s.after(n)}function u(){e(),a()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u(),document.addEventListener("turbo:load",u),window.TaskInlineEdit={updateStatus:n,saveFilter:o,applyFilter:r,deleteFilter:l}}();