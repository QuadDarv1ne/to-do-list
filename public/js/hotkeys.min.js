class HotkeysManager{constructor(){this.shortcuts=new Map,this.enabled=!0,this.init()}init(){this.registerDefaultShortcuts(),this.bindEvents(),this.createHelpModal()}registerDefaultShortcuts(){this.register("g d",()=>this.navigate("/dashboard"),"Перейти на панель управления"),this.register("g t",()=>this.navigate("/task"),"Перейти к задачам"),this.register("g k",()=>this.navigate("/kanban"),"Перейти к канбан-доске"),this.register("g c",()=>this.navigate("/calendar"),"Перейти к календарю"),this.register("g u",()=>this.navigate("/user"),"Перейти к пользователям"),this.register("g p",()=>this.navigate("/profile"),"Перейти к профилю"),this.register("g s",()=>this.navigate("/settings"),"Перейти к настройкам"),this.register("n",()=>this.createTask(),"Создать новую задачу"),this.register("/",()=>this.openSearch(),"Открыть поиск"),this.register("ctrl+k",()=>this.openQuickSearch(),"Быстрый поиск"),this.register("?",()=>this.showHelp(),"Показать справку по горячим клавишам"),this.register("r",()=>this.refresh(),"Обновить страницу"),this.register("esc",()=>this.closeModals(),"Закрыть модальные окна"),this.register("t",()=>this.toggleTheme(),"Переключить тему"),this.register("ctrl+a",()=>this.selectAll(),"Выбрать все"),this.register("ctrl+shift+a",()=>this.deselectAll(),"Снять выделение")}register(e,t,s=""){const n=this.normalizeKeys(e);this.shortcuts.set(n,{callback:t,description:s,keys:e})}unregister(e){const t=this.normalizeKeys(e);this.shortcuts.delete(t)}normalizeKeys(e){return e.toLowerCase().replace(/\s+/g," ").split(" ").map(e=>e.trim()).filter(e=>e.length>0).join(" ")}bindEvents(){let e=[],t=null;document.addEventListener("keydown",s=>{if(!this.enabled||["INPUT","TEXTAREA","SELECT"].includes(s.target.tagName))return;if(s.target.isContentEditable)return;const n=this.getKeyString(s);clearTimeout(t),e.push(n);const i=this.matchShortcut(e);i?(s.preventDefault(),e=[],i.callback()):t=setTimeout(()=>{e=[]},1e3)})}getKeyString(e){const t=[];e.ctrlKey&&t.push("ctrl"),e.altKey&&t.push("alt"),e.shiftKey&&t.push("shift"),e.metaKey&&t.push("meta");const s=e.key.toLowerCase();return["control","alt","shift","meta"].includes(s)||t.push(s),t.join("+")}matchShortcut(e){const t=e.join(" ");for(const[e,s]of this.shortcuts)if(e===t)return s;return null}navigate(e){window.location.href=e}createTask(){const e=document.getElementById("quick-task-fab");e?e.click():this.navigate("/task/new")}openSearch(){const e=document.querySelector('input[name="search"], input[type="search"]');e&&(e.focus(),e.select())}openQuickSearch(){window.quickSearch?window.quickSearch.open():this.openSearch()}refresh(){window.location.reload()}closeModals(){document.querySelectorAll(".modal.show").forEach(e=>{const t=bootstrap.Modal.getInstance(e);t&&t.hide()})}toggleTheme(){const e=document.getElementById("themeToggle");e&&e.click()}selectAll(){const e=document.getElementById("select-all-tasks");e&&(e.checked=!0,e.dispatchEvent(new Event("change")))}deselectAll(){const e=document.getElementById("select-all-tasks");e&&(e.checked=!1,e.dispatchEvent(new Event("change")))}showHelp(){const e=document.getElementById("hotkeysHelpModal");if(e){new bootstrap.Modal(e).show()}}createHelpModal(){const e=Array.from(this.shortcuts.entries()),t=this.groupShortcuts(e);let s="";for(const[e,n]of Object.entries(t))s+=`\n                <div class="col-md-6 mb-4">\n                    <h6 class="text-uppercase text-muted mb-3">${e}</h6>\n                    <div class="list-group list-group-flush">\n                        ${n.map(([e,t])=>`\n                            <div class="list-group-item border-0 px-0 py-2">\n                                <div class="d-flex justify-content-between align-items-center">\n                                    <span>${t.description}</span>\n                                    <div class="hotkey-combo">\n                                        ${this.renderKeys(t.keys)}\n                                    </div>\n                                </div>\n                            </div>\n                        `).join("")}\n                    </div>\n                </div>\n            `;const n=`\n            <div class="modal fade" id="hotkeysHelpModal" tabindex="-1" aria-labelledby="hotkeysHelpLabel" aria-hidden="true">\n                <div class="modal-dialog modal-lg">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h5 class="modal-title" id="hotkeysHelpLabel">\n                                <i class="fas fa-keyboard me-2"></i>\n                                Горячие клавиши\n                            </h5>\n                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                        </div>\n                        <div class="modal-body">\n                            <div class="row">\n                                ${s}\n                            </div>\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;document.body.insertAdjacentHTML("beforeend",n)}groupShortcuts(e){const t={"Навигация":[],"Действия":[],"Прочее":[]};return e.forEach(([e,s])=>{e.startsWith("g ")?t["Навигация"].push([e,s]):["n","ctrl+k","/"].includes(e)?t["Действия"].push([e,s]):t["Прочее"].push([e,s])}),t}renderKeys(e){return e.split(" ").map(e=>e.split("+").map(e=>`<kbd>${this.getKeyDisplay(e)}</kbd>`).join('<span class="mx-1">+</span>')).join('<span class="mx-2">затем</span>')}getKeyDisplay(e){return{ctrl:"Ctrl",alt:"Alt",shift:"Shift",meta:"Cmd",escape:"Esc",arrowup:"↑",arrowdown:"↓",arrowleft:"←",arrowright:"→",enter:"Enter"," ":"Space"}[e.toLowerCase()]||e.toUpperCase()}enable(){this.enabled=!0}disable(){this.enabled=!1}}const hotkeysStyles="\n<style>\n.hotkey-combo {\n    display: flex;\n    align-items: center;\n    gap: 0.25rem;\n}\n\n.hotkey-combo kbd {\n    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);\n    border: 1px solid #dee2e6;\n    border-radius: 4px;\n    padding: 4px 8px;\n    font-size: 0.75rem;\n    font-family: 'Courier New', monospace;\n    font-weight: 600;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n    min-width: 24px;\n    text-align: center;\n}\n\n[data-theme=\"dark\"] .hotkey-combo kbd {\n    background: linear-gradient(135deg, #343a40 0%, #495057 100%);\n    border-color: #495057;\n    color: #f8f9fa;\n}\n</style>\n";document.head.insertAdjacentHTML("beforeend",hotkeysStyles),document.addEventListener("DOMContentLoaded",()=>{window.hotkeysManager=new HotkeysManager});