!function(){"use strict";window.performanceOptimizer={lazyImages:new class{constructor(e={}){this.defaults={rootMargin:"50px",threshold:.01,placeholder:'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 9"%3E%3C/svg%3E',loadHidden:!1},this.config={...this.defaults,...e},this.observer=null}init(){"IntersectionObserver"in window?(this.observer=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(this.loadImage(e.target),this.observer.unobserve(e.target))})},{rootMargin:this.config.rootMargin,threshold:this.config.threshold}),document.querySelectorAll("img[data-src], img[data-srcset]").forEach(e=>{this.observer.observe(e)})):this.loadAll()}loadImage(e){const t=e.dataset.src,s=e.dataset.srcset;t&&(e.src=t),s&&(e.srcset=s),e.removeAttribute("data-src"),e.removeAttribute("data-srcset"),e.classList.add("loaded"),e.complete?e.classList.add("complete"):e.addEventListener("load",()=>{e.classList.add("complete")})}loadAll(){document.querySelectorAll("img[data-src], img[data-srcset]").forEach(e=>{this.loadImage(e)})}},lazyComponents:new class{constructor(){this.observer=null,this.loadedComponents=new Set}init(){"IntersectionObserver"in window?(this.observer=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&!this.loadedComponents.has(e.target)&&(this.loadComponent(e.target),this.loadedComponents.add(e.target),this.observer.unobserve(e.target))})},{rootMargin:"100px",threshold:.1}),document.querySelectorAll("[data-lazy-component]").forEach(e=>{this.observer.observe(e)})):this.loadAll()}loadComponent(e){const t=e.dataset.lazyComponent,s=e.dataset.dataUrl;s?this.loadFromUrl(e,s):t&&this.loadComponentType(e,t)}loadFromUrl(e,t){e.classList.add("loading"),fetch(t).then(e=>e.text()).then(t=>{e.innerHTML=t,e.classList.remove("loading"),e.classList.add("loaded")}).catch(t=>{console.error("Error loading component:",t),e.classList.remove("loading"),e.classList.add("error")})}loadComponentType(e,t){console.log(`Loading component type: ${t}`),e.classList.add("loaded")}loadAll(){document.querySelectorAll("[data-lazy-component]").forEach(e=>{this.loadComponent(e)})}},imageOptimizer:new class{constructor(){this.supportedFormats=["webp","avif"]}init(){this.convertToWebP(),this.addResponsiveImages()}convertToWebP(){this.supportsWebP()&&document.querySelectorAll('img[src*=".jpg"], img[src*=".jpeg"], img[src*=".png"]').forEach(e=>{const t=this.changeExtension(e.src,".webp"),s=document.createElement("picture"),o=document.createElement("source");o.srcset=t,o.type="image/webp";const r=e.cloneNode(!1);r.src=e.src,s.appendChild(o),s.appendChild(r),e.parentNode.replaceChild(s,e)})}supportsWebP(){const e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))&&0===e.toDataURL("image/webp").indexOf("data:image/webp")}changeExtension(e,t){return e.replace(/\.[^/.]+$/,t)}addResponsiveImages(){document.querySelectorAll("img[data-sizes]").forEach(e=>{e.sizes=e.dataset.sizes})}},scrollPerformance:new class{constructor(){this.lastScrollTop=0,this.ticking=!1}init(){this.setupScrollListener(),this.setupSmoothScroll()}setupScrollListener(){window.addEventListener("scroll",()=>{this.ticking||(window.requestAnimationFrame(()=>{this.handleScroll(),this.ticking=!1}),this.ticking=!0)},{passive:!0})}handleScroll(){const e=window.pageYOffset||document.documentElement.scrollTop,t=document.querySelector(".navbar, header");t&&(e>this.lastScrollTop&&e>100?(t.classList.add("scroll-down"),t.classList.remove("scroll-up")):(t.classList.add("scroll-up"),t.classList.remove("scroll-down"))),this.updateScrollProgress(),this.lastScrollTop=e<=0?0:e}updateScrollProgress(){const e=(document.body.scrollTop||document.documentElement.scrollTop)/(document.documentElement.scrollHeight-document.documentElement.clientHeight)*100;let t=document.getElementById("scroll-progress");t||(t=document.createElement("div"),t.id="scroll-progress",t.style.cssText="position:fixed;top:0;left:0;height:3px;background:linear-gradient(90deg,var(--primary),var(--success));z-index:9999;transition:width 0.1s;",document.body.prepend(t)),t.style.width=e+"%"}setupSmoothScroll(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){const t=this.getAttribute("href");if("#"===t)return;const s=document.querySelector(t);s&&(e.preventDefault(),s.scrollIntoView({behavior:"smooth",block:"start"}))})})}},memoryManager:new class{constructor(){this.eventListeners=new Map}addEventListener(e,t,s,o={}){const r=`${e.id||e.className}-${t}-${s.name||"anonymous"}`;e.addEventListener(t,s,{passive:o.passive??!0,capture:o.capture??!1}),this.eventListeners.has(r)||this.eventListeners.set(r,{element:e,event:t,handler:s})}cleanup(){this.eventListeners.forEach((e,t)=>{e.element.removeEventListener(e.event,e.handler),this.eventListeners.delete(t)})}},cache:new class{constructor(e="crm_cache_"){this.prefix=e,this.defaultTTL=36e5}set(e,t,s=this.defaultTTL){const o={value:t,expiry:Date.now()+s};try{localStorage.setItem(this.prefix+e,JSON.stringify(o))}catch(e){console.warn("Cache storage failed:",e)}}get(e){try{const t=localStorage.getItem(this.prefix+e);if(!t)return null;const s=JSON.parse(t);return Date.now()>s.expiry?(this.remove(e),null):s.value}catch(e){return console.warn("Cache retrieval failed:",e),null}}remove(e){try{localStorage.removeItem(this.prefix+e)}catch(e){console.warn("Cache removal failed:",e)}}clear(){try{Object.keys(localStorage).forEach(e=>{e.startsWith(this.prefix)&&localStorage.removeItem(e)})}catch(e){console.warn("Cache clear failed:",e)}}},utils:class{static debounce(e,t){let s;return function(...o){clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),e(...o)},t)}}static throttle(e,t){let s;return function(...o){s||(e.apply(this,o),s=!0,setTimeout(()=>s=!1,t))}}},init(){this.lazyImages.init(),this.lazyComponents.init(),this.imageOptimizer.init(),this.scrollPerformance.init(),console.log("Performance optimizer initialized")}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.performanceOptimizer.init()}):window.performanceOptimizer.init()}();