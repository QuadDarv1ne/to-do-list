!function(){"use strict";class t{constructor(){this.notificationCountElement=document.getElementById("notificationCount"),this.updateInProgress=!1,this.lastUpdate=0,this.updateThrottle=5e3,this.init()}init(){this.bindEvents(),setTimeout(()=>this.updateNotificationCount(),1e3),setInterval(()=>this.updateNotificationCount(),3e5)}async updateNotificationCount(){const t=Date.now();if(!(this.updateInProgress||t-this.lastUpdate<this.updateThrottle)){this.updateInProgress=!0,this.lastUpdate=t;try{const t=await fetch("/api/notifications/unread-count",{cache:"no-cache",headers:{"X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();if(this.notificationCountElement){const t=e.unread||0;this.notificationCountElement.textContent=t>99?"99+":t,this.notificationCountElement.classList.toggle("d-none",0===t),t>0&&(this.notificationCountElement.style.animation="pulse-badge 2s infinite")}}catch(t){window.console&&console.error&&console.error("Failed to update notification count:",t)}finally{this.updateInProgress=!1}}}bindEvents(){const t=document.getElementById("markAllRead");t&&t.addEventListener("click",async t=>{t.preventDefault(),await this.markAllAsRead()})}async markAllAsRead(){try{(await fetch("/api/notifications/mark-all-read",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"})).ok&&await this.updateNotificationCount()}catch(t){window.console&&console.error&&console.error("Failed to mark notifications as read:",t)}}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.realTimeNotifications=new t}):window.realTimeNotifications=new t}();