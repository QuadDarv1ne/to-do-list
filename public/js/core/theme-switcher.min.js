class ThemeSwitcher{constructor(){this.currentTheme=this.getStoredTheme()||"light",this.themes=["light","dark","orange","purple","custom"],this.customColors=this.getStoredCustomColors(),this.init()}init(){this.applyTheme(this.currentTheme),this.setupEventListeners(),this.updateThemeUI(),this.watchSystemTheme()}setupEventListeners(){document.querySelectorAll("[data-theme-select]").forEach(e=>{e.addEventListener("click",e=>{const t=e.currentTarget.dataset.themeSelect;if("custom"===t){const e=document.getElementById("customThemeControls");e&&(e.style.display="block")}else{this.setTheme(t);const e=bootstrap.Modal.getInstance(document.getElementById("themeModal"));e&&setTimeout(()=>e.hide(),300)}})});Object.entries({customPrimary:"custom-primary",customBgBody:"custom-bg-body",customBgCard:"custom-bg-card",customTextPrimary:"custom-text-primary",customSuccess:"custom-success",customDanger:"custom-danger"}).forEach(([e,t])=>{const s=document.getElementById(e);s&&s.addEventListener("change",e=>{this.setCustomColor(t,e.target.value)})});const e=document.getElementById("applyCustomTheme");e&&e.addEventListener("click",()=>{this.setTheme("custom");const e=bootstrap.Modal.getInstance(document.getElementById("themeModal"));e&&setTimeout(()=>e.hide(),300)});const t=document.getElementById("resetCustomTheme");t&&t.addEventListener("click",()=>{this.resetCustomColors()});const s=document.getElementById("autoThemeSwitch");s&&(s.checked=this.getAutoSwitchPreference(),s.addEventListener("change",e=>{this.setAutoSwitch(e.target.checked)}))}setTheme(e){this.themes.includes(e)?(document.body.classList.add("theme-switching"),this.currentTheme=e,this.applyTheme(e),this.storeTheme(e),this.updateThemeUI(),setTimeout(()=>{document.body.classList.remove("theme-switching")},300),this.dispatchThemeChange(e)):console.error(`Invalid theme: ${e}`)}applyTheme(e){document.documentElement.setAttribute("data-theme",e),"custom"===e&&this.customColors&&this.applyCustomColors()}cycleTheme(){const e=(this.themes.indexOf(this.currentTheme)+1)%this.themes.length;this.setTheme(this.themes[e])}setCustomColor(e,t){this.customColors||(this.customColors={}),this.customColors[e]=t,this.storeCustomColors(),"custom"===this.currentTheme&&this.applyCustomColors()}applyCustomColors(){if(!this.customColors)return;const e=document.documentElement;Object.entries(this.customColors).forEach(([t,s])=>{e.style.setProperty(`--${t}`,s)})}updateThemeUI(){if(document.querySelectorAll("[data-theme-select]").forEach(e=>{e.dataset.themeSelect===this.currentTheme?(e.classList.add("active"),e.setAttribute("aria-pressed","true")):(e.classList.remove("active"),e.setAttribute("aria-pressed","false"))}),this.customColors){const e={"custom-primary":"customPrimary","custom-bg-body":"customBgBody","custom-bg-card":"customBgCard","custom-text-primary":"customTextPrimary","custom-success":"customSuccess","custom-danger":"customDanger"};Object.entries(this.customColors).forEach(([t,s])=>{const o=e[t],r=document.getElementById(o);r&&(r.value=s)})}}getThemeIcon(e){return{light:"fas fa-sun",dark:"fas fa-moon",orange:"fas fa-fire",purple:"fas fa-star",custom:"fas fa-palette"}[e]||"fas fa-adjust"}watchSystemTheme(){if(!window.matchMedia)return;window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{this.getStoredTheme()||this.setTheme(e.matches?"dark":"light")})}storeTheme(e){try{localStorage.setItem("app-theme",e)}catch(e){console.error("Failed to store theme preference:",e)}}getStoredTheme(){try{return localStorage.getItem("app-theme")}catch(e){return console.error("Failed to retrieve theme preference:",e),null}}storeCustomColors(){try{localStorage.setItem("app-custom-colors",JSON.stringify(this.customColors))}catch(e){console.error("Failed to store custom colors:",e)}}getStoredCustomColors(){try{const e=localStorage.getItem("app-custom-colors");return e?JSON.parse(e):null}catch(e){return console.error("Failed to retrieve custom colors:",e),null}}dispatchThemeChange(e){const t=new CustomEvent("themechange",{detail:{theme:e,customColors:this.customColors}});window.dispatchEvent(t)}getCurrentTheme(){return this.currentTheme}getAvailableThemes(){return[...this.themes]}resetToDefault(){this.setTheme("light"),this.customColors=null;try{localStorage.removeItem("app-custom-colors")}catch(e){console.error("Failed to clear custom colors:",e)}}resetCustomColors(){this.customColors={"custom-primary":"#667eea","custom-bg-body":"#f9fafb","custom-bg-card":"#ffffff","custom-text-primary":"#1f2937","custom-success":"#10b981","custom-danger":"#ef4444"},this.storeCustomColors(),this.updateThemeUI(),"custom"===this.currentTheme&&this.applyCustomColors()}setAutoSwitch(e){try{localStorage.setItem("app-auto-theme-switch",e?"true":"false"),e?this.enableAutoSwitch():this.disableAutoSwitch()}catch(e){console.error("Failed to store auto-switch preference:",e)}}getAutoSwitchPreference(){try{return"true"===localStorage.getItem("app-auto-theme-switch")}catch(e){return!1}}enableAutoSwitch(){const e=(new Date).getHours(),t=e>=6&&e<18;this.setTheme(t?"light":"dark"),this.autoSwitchInterval&&clearInterval(this.autoSwitchInterval),this.autoSwitchInterval=setInterval(()=>{const e=(new Date).getHours(),t=e>=6&&e<18?"light":"dark";this.currentTheme!==t&&this.setTheme(t)},6e4)}disableAutoSwitch(){this.autoSwitchInterval&&(clearInterval(this.autoSwitchInterval),this.autoSwitchInterval=null)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.themeSwitcher=new ThemeSwitcher}):window.themeSwitcher=new ThemeSwitcher,"undefined"!=typeof module&&module.exports&&(module.exports=ThemeSwitcher);