class StateManager{constructor(){this.state={},this.listeners={},this.storage=this.getStorage(),this.init()}init(){try{const t=this.storage.getItem("app-state");t&&(this.state=JSON.parse(t))}catch(t){console.warn("Failed to load state from storage:",t)}this.state={theme:this.state.theme||this.detectTheme(),sidebarCollapsed:this.state.sidebarCollapsed||!1,notifications:this.state.notifications||[],preferences:this.state.preferences||{},cache:this.state.cache||{},...this.state},this.applyTheme(this.state.theme)}getStorage(){try{const t="__storage_test__";return localStorage.setItem(t,t),localStorage.removeItem(t),localStorage}catch(t){return{data:{},getItem(t){return this.data[t]||null},setItem(t,e){this.data[t]=e},removeItem(t){delete this.data[t]},clear(){this.data={}}}}}detectTheme(){const t=this.storage.getItem("theme");return t||(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}get(t,e=null){const s=t.split(".");let a=this.state;for(const t of s){if(!a||"object"!=typeof a||!(t in a))return e;a=a[t]}return a}set(t,e,s=!0){const a=t.split("."),r=a.pop();let i=this.state;for(const t of a)t in i||(i[t]={}),i=i[t];const n=i[r];return i[r]=e,s&&this.persist(),this.notify(t,e,n),this}subscribe(t,e){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e),()=>{this.listeners[t]=this.listeners[t].filter(t=>t!==e)}}notify(t,e,s){this.listeners[t]&&this.listeners[t].forEach(t=>{try{t(e,s)}catch(t){console.error("Error in state listener:",t)}})}persist(){try{this.storage.setItem("app-state",JSON.stringify(this.state))}catch(t){console.warn("Failed to persist state:",t)}}clear(){this.state={},this.storage.removeItem("app-state"),this.notify("*",null,null)}setTheme(t){this.set("theme",t),this.applyTheme(t),this.storage.setItem("theme",t)}applyTheme(t){document.documentElement.setAttribute("data-theme",t);const e=document.querySelector('meta[name="theme-color"]');if(e){const s={light:"#ffffff",dark:"#1f2937",orange:"#f97316",purple:"#a855f7"};e.setAttribute("content",s[t]||s.light)}}setCache(t,e,s=36e5){const a={value:e,timestamp:Date.now(),ttl:s};this.set(`cache.${t}`,a)}getCache(t){const e=this.get(`cache.${t}`);return e?Date.now()-e.timestamp>e.ttl?(this.clearCache(t),null):e.value:null}clearCache(t){if(t){const e=this.get("cache",{});delete e[t],this.set("cache",e)}else this.set("cache",{})}setPreference(t,e){this.set(`preferences.${t}`,e)}getPreference(t,e=null){return this.get(`preferences.${t}`,e)}updateNetworkStatus(){const t=navigator.onLine,e=navigator.connection||navigator.mozConnection||navigator.webkitConnection,s={online:t,effectiveType:e?.effectiveType||"unknown",downlink:e?.downlink||0,rtt:e?.rtt||0,saveData:e?.saveData||!1};return this.set("network",s,!1),s}recordMetric(t,e){const s=this.get("metrics",{});s[t]||(s[t]=[]),s[t].push({value:e,timestamp:Date.now()}),s[t].length>100&&(s[t]=s[t].slice(-100)),this.set("metrics",s,!1)}getMetrics(t){return this.get(`metrics.${t}`,[])}isFeatureEnabled(t){return this.get(`features.${t}`,!1)}enableFeature(t){this.set(`features.${t}`,!0)}disableFeature(t){this.set(`features.${t}`,!1)}}const stateManager=new StateManager;window.addEventListener("online",()=>{stateManager.updateNetworkStatus(),document.body.classList.remove("offline")}),window.addEventListener("offline",()=>{stateManager.updateNetworkStatus(),document.body.classList.add("offline")}),navigator.connection&&navigator.connection.addEventListener("change",()=>{stateManager.updateNetworkStatus()}),stateManager.updateNetworkStatus(),window.StateManager=stateManager,"undefined"!=typeof module&&module.exports&&(module.exports=StateManager);