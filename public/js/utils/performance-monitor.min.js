!function(){"use strict";class e{constructor(){this.metrics={},this.observers={},this.init()}init(){window.performance?"complete"===document.readyState?this.startMonitoring():window.addEventListener("load",()=>this.startMonitoring()):console.warn("Performance API not supported")}startMonitoring(){this.measureNavigationTiming(),this.measureCoreWebVitals(),this.measureResourceTiming(),this.setupPerformanceObserver(),this.monitorLongTasks(),this.monitorMemory()}measureNavigationTiming(){const e=performance.getEntriesByType("navigation")[0];e&&(this.metrics.navigation={dns:e.domainLookupEnd-e.domainLookupStart,tcp:e.connectEnd-e.connectStart,request:e.responseStart-e.requestStart,response:e.responseEnd-e.responseStart,dom:e.domContentLoadedEventEnd-e.domContentLoadedEventStart,load:e.loadEventEnd-e.loadEventStart,total:e.loadEventEnd-e.fetchStart},this.reportMetric("navigation",this.metrics.navigation))}measureCoreWebVitals(){this.measureLCP(),this.measureFID(),this.measureCLS(),this.measureFCP(),this.measureTTI()}measureLCP(){if("PerformanceObserver"in window)try{const e=new PerformanceObserver(e=>{const t=e.getEntries(),r=t[t.length-1];this.metrics.lcp=r.renderTime||r.loadTime,this.reportMetric("lcp",this.metrics.lcp),this.metrics.lcp>4e3&&console.warn("LCP is poor:",this.metrics.lcp)});e.observe({entryTypes:["largest-contentful-paint"]}),this.observers.lcp=e}catch(e){console.warn("LCP measurement failed:",e)}}measureFID(){if("PerformanceObserver"in window)try{const e=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{this.metrics.fid=e.processingStart-e.startTime,this.reportMetric("fid",this.metrics.fid),this.metrics.fid>300&&console.warn("FID is poor:",this.metrics.fid)})});e.observe({entryTypes:["first-input"]}),this.observers.fid=e}catch(e){console.warn("FID measurement failed:",e)}}measureCLS(){if(!("PerformanceObserver"in window))return;let e=0;try{const t=new PerformanceObserver(t=>{t.getEntries().forEach(t=>{t.hadRecentInput||(e+=t.value,this.metrics.cls=e,this.reportMetric("cls",this.metrics.cls),this.metrics.cls>.25&&console.warn("CLS is poor:",this.metrics.cls))})});t.observe({entryTypes:["layout-shift"]}),this.observers.cls=t}catch(e){console.warn("CLS measurement failed:",e)}}measureFCP(){const e=performance.getEntriesByType("paint").find(e=>"first-contentful-paint"===e.name);e&&(this.metrics.fcp=e.startTime,this.reportMetric("fcp",this.metrics.fcp))}measureTTI(){"complete"===document.readyState?(this.metrics.tti=performance.now(),this.reportMetric("tti",this.metrics.tti)):window.addEventListener("load",()=>{setTimeout(()=>{this.metrics.tti=performance.now(),this.reportMetric("tti",this.metrics.tti)},0)})}measureResourceTiming(){const e=performance.getEntriesByType("resource"),t={total:e.length,css:0,js:0,img:0,font:0,other:0,totalSize:0,totalDuration:0};e.forEach(e=>{const r=this.getResourceType(e.name);t[r]++,t.totalSize+=e.transferSize||0,t.totalDuration+=e.duration}),this.metrics.resources=t,this.reportMetric("resources",t)}getResourceType(e){return e.match(/\.css/)?"css":e.match(/\.js/)?"js":e.match(/\.(jpg|jpeg|png|gif|webp|svg)/)?"img":e.match(/\.(woff|woff2|ttf|otf)/)?"font":"other"}setupPerformanceObserver(){if("PerformanceObserver"in window)try{const e=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{e.duration>1e3&&console.warn("Slow resource:",e.name,e.duration+"ms")})});e.observe({entryTypes:["resource","measure"]}),this.observers.performance=e}catch(e){console.warn("Performance Observer setup failed:",e)}}monitorLongTasks(){if("PerformanceObserver"in window)try{const e=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{console.warn("Long task detected:",e.duration+"ms"),this.metrics.longTasks||(this.metrics.longTasks=[]),this.metrics.longTasks.push({duration:e.duration,startTime:e.startTime})})});e.observe({entryTypes:["longtask"]}),this.observers.longTasks=e}catch(e){}}monitorMemory(){if(!performance.memory)return;this.metrics.memory={used:performance.memory.usedJSHeapSize,total:performance.memory.totalJSHeapSize,limit:performance.memory.jsHeapSizeLimit},this.reportMetric("memory",this.metrics.memory);const e=this.metrics.memory.used/this.metrics.memory.limit*100;e>90&&console.warn("High memory usage:",e.toFixed(2)+"%")}reportMetric(e,t){window.StateManager&&window.StateManager.recordMetric(e,t),document.dispatchEvent(new CustomEvent("performance-metric",{detail:{name:e,value:t}}))}getMetrics(){return this.metrics}getScore(){let e=100;return this.metrics.lcp>4e3?e-=20:this.metrics.lcp>2500&&(e-=10),this.metrics.fid>300?e-=20:this.metrics.fid>100&&(e-=10),this.metrics.cls>.25?e-=20:this.metrics.cls>.1&&(e-=10),this.metrics.fcp>3e3?e-=15:this.metrics.fcp>1800&&(e-=7),this.metrics.tti>5e3?e-=15:this.metrics.tti>3800&&(e-=7),Math.max(0,e)}generateReport(){const e=this.getScore();return{score:e,grade:e>=90?"A":e>=80?"B":e>=70?"C":e>=60?"D":"F",metrics:this.metrics,timestamp:(new Date).toISOString()}}logReport(){const e=this.generateReport();return console.group("Performance Report"),console.log("Score:",e.score,"("+e.grade+")"),console.log("Metrics:",e.metrics),console.groupEnd(),e}disconnect(){Object.values(this.observers).forEach(e=>{e&&e.disconnect&&e.disconnect()})}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.PerformanceMonitor=new e}):window.PerformanceMonitor=new e,setTimeout(()=>{window.PerformanceMonitor&&window.PerformanceMonitor.logReport()},5e3)}();