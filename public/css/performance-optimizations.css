/* ============================================
   PERFORMANCE OPTIMIZATIONS
   GPU acceleration, will-change, containment
   ============================================ */

/* === GPU ACCELERATION === */
.gpu-accelerated {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000px;
}

/* Apply to animated elements */
.card,
.btn,
.modal,
.dropdown-menu,
.toast,
.notification-item {
    transform: translateZ(0);
    will-change: transform, opacity;
}

/* Remove will-change after animation */
.card:not(:hover),
.btn:not(:hover):not(:active),
.modal:not(.show),
.dropdown-menu:not(.show) {
    will-change: auto;
}

/* === CSS CONTAINMENT === */
.card {
    contain: layout style paint;
}

.list-group-item,
.table tr,
.notification-item {
    contain: layout style;
}

.modal-content {
    contain: layout;
}

/* === CONTENT VISIBILITY === */
.lazy-content {
    content-visibility: auto;
    contain-intrinsic-size: 0 500px;
}

.task-item,
.notification-item,
.search-result-item {
    content-visibility: auto;
    contain-intrinsic-size: 0 80px;
}

/* === OPTIMIZED ANIMATIONS === */
@media (prefers-reduced-motion: no-preference) {
    /* Use transform and opacity only for smooth 60fps animations */
    .smooth-transition {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                    opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Optimize hover effects */
    .card:hover {
        transform: translateY(-2px) translateZ(0);
    }
    
    .btn:hover {
        transform: translateY(-1px) translateZ(0);
    }
    
    /* Optimize modal animations */
    .modal.fade .modal-dialog {
        transform: translate(0, -50px) translateZ(0);
        transition: transform 0.3s ease-out;
    }
    
    .modal.show .modal-dialog {
        transform: translate(0, 0) translateZ(0);
    }
}

/* === SCROLL PERFORMANCE === */
.scrollable-container {
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
}

/* Optimize table scrolling */
.table-responsive {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    will-change: scroll-position;
}

.table-responsive:not(:hover) {
    will-change: auto;
}

/* === IMAGE OPTIMIZATION === */
img {
    content-visibility: auto;
    contain-intrinsic-size: 0 200px;
}

/* Lazy loaded images */
img[loading="lazy"] {
    opacity: 0;
    transition: opacity 0.3s ease;
}

img[loading="lazy"].loaded {
    opacity: 1;
}

/* === FONT RENDERING === */
body {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
}

/* Optimize icon rendering */
.fas, .far, .fab {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* === LAYOUT SHIFT PREVENTION === */
/* Reserve space for dynamic content */
.avatar-placeholder {
    width: 36px;
    height: 36px;
    background: var(--border);
    border-radius: 50%;
}

.skeleton-text {
    height: 1em;
    background: var(--border);
    border-radius: 4px;
    margin-bottom: 0.5em;
}

.skeleton-text:last-child {
    width: 60%;
}

/* === PAINT OPTIMIZATION === */
/* Isolate expensive paint operations */
.card::before,
.btn::before {
    isolation: isolate;
}

/* Reduce paint area */
.dropdown-menu {
    contain: layout style paint;
}

/* === COMPOSITE LAYERS === */
/* Create composite layers for frequently animated elements */
.fab-enter,
.notification-toast,
.modal-backdrop {
    will-change: transform, opacity;
    transform: translateZ(0);
}

/* === CRITICAL RENDERING PATH === */
/* Inline critical CSS for above-the-fold content */
.above-fold {
    contain: layout style;
}

/* Defer below-the-fold content */
.below-fold {
    content-visibility: auto;
}

/* === MEMORY OPTIMIZATION === */
/* Limit animation iterations */
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.pulse-animation {
    animation: pulse 2s ease-in-out 3; /* Limit to 3 iterations */
}

/* === RESPONSIVE IMAGES === */
/* Use srcset for responsive images */
img[srcset] {
    width: 100%;
    height: auto;
}

/* === INTERSECTION OBSERVER TARGETS === */
.observe-visibility {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease, transform 0.6s ease;
}

.observe-visibility.visible {
    opacity: 1;
    transform: translateY(0);
}

/* === DEBOUNCED EVENTS === */
/* Optimize resize/scroll handlers */
.resize-optimized,
.scroll-optimized {
    pointer-events: none;
}

.resize-optimized.ready,
.scroll-optimized.ready {
    pointer-events: auto;
}

/* === PREFETCH HINTS === */
/* Add prefetch for likely navigation */
a[rel="prefetch"]::after {
    content: '';
    display: none;
}

/* === REDUCED MOTION === */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
    
    /* Remove will-change */
    * {
        will-change: auto !important;
    }
}

/* === DARK MODE OPTIMIZATION === */
@media (prefers-color-scheme: dark) {
    /* Optimize dark mode rendering */
    :root:not([data-theme]) {
        color-scheme: dark;
    }
}

/* === HIGH CONTRAST === */
@media (prefers-contrast: high) {
    /* Simplify styles for high contrast */
    .card,
    .btn {
        box-shadow: none;
    }
    
    .card {
        border-width: 2px;
    }
}

/* === PRINT OPTIMIZATION === */
@media print {
    /* Remove unnecessary elements */
    .no-print,
    .navbar,
    .sidebar,
    .fab-enter,
    .notification-toast {
        display: none !important;
    }
    
    /* Optimize for print */
    * {
        background: transparent !important;
        box-shadow: none !important;
        text-shadow: none !important;
    }
    
    a,
    a:visited {
        text-decoration: underline;
    }
    
    /* Page breaks */
    .card,
    .table {
        page-break-inside: avoid;
    }
    
    h1, h2, h3, h4, h5, h6 {
        page-break-after: avoid;
    }
}

/* === LOADING STATES === */
.loading-state {
    pointer-events: none;
    opacity: 0.6;
    position: relative;
}

.loading-state::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 24px;
    height: 24px;
    margin: -12px 0 0 -12px;
    border: 3px solid var(--primary);
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    will-change: transform;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* === VIRTUALIZATION SUPPORT === */
.virtual-scroll-container {
    overflow-y: auto;
    position: relative;
    contain: strict;
}

.virtual-scroll-spacer {
    pointer-events: none;
}

.virtual-scroll-item {
    position: absolute;
    left: 0;
    right: 0;
    contain: layout style paint;
}

/* === NETWORK OPTIMIZATION === */
/* Indicate slow network */
.slow-network-indicator {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--warning);
    color: #000;
    padding: 0.5rem 1rem;
    border-radius: var(--radius);
    font-size: 0.875rem;
    z-index: 1050;
    display: none;
}

.slow-network .slow-network-indicator {
    display: block;
}

/* === BATTERY OPTIMIZATION === */
@media (prefers-reduced-motion: reduce),
       (prefers-contrast: high) {
    /* Reduce animations when battery is low */
    * {
        animation-duration: 0s !important;
        transition-duration: 0s !important;
    }
}
