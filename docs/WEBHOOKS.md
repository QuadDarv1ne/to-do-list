# Webhooks ‚Äî –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìö –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ webhooks –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–æ –≤–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏–π –≤ CRM.

## üîß –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ webhook'–∞–º–∏ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ HMAC-–ø–æ–¥–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook'–æ–≤
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ webhook'–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üìç –ú–∞—Ä—à—Ä—É—Ç—ã

| –ú–∞—Ä—à—Ä—É—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-------|----------|
| `/webhook/` | GET | –°–ø–∏—Å–æ–∫ webhook'–æ–≤ |
| `/webhook/new` | GET/POST | –°–æ–∑–¥–∞–Ω–∏–µ webhook'–∞ |
| `/webhook/{id}` | GET | –ü—Ä–æ—Å–º–æ—Ç—Ä webhook'–∞ |
| `/webhook/{id}/edit` | GET/POST | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook'–∞ |
| `/webhook/{id}` | POST | –£–¥–∞–ª–µ–Ω–∏–µ webhook'–∞ |
| `/webhook/{id}/toggle` | POST | –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å |
| `/webhook/{id}/test` | POST | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook'–∞ |
| `/webhook/{id}/logs` | GET | –ñ—É—Ä–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–æ–∫ |
| `/webhook/{id}/retry` | POST | –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ |

## üì° –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

| –°–æ–±—ã—Ç–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `task.created` | –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ |
| `task.updated` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ |
| `task.completed` | –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ |
| `task.deleted` | –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ |
| `deal.created` | –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏ |
| `deal.won` | –°–¥–µ–ª–∫–∞ –≤—ã–∏–≥—Ä–∞–Ω–∞ |
| `deal.lost` | –°–¥–µ–ª–∫–∞ –ø—Ä–æ–∏–≥—Ä–∞–Ω–∞ |
| `client.created` | –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ |
| `comment.added` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è |

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### HMAC-–ø–æ–¥–ø–∏—Å—å

–ö–∞–∂–¥—ã–π webhook –∑–∞–ø—Ä–æ—Å –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º HMAC-SHA256.

**–ó–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞:**
```
X-Webhook-Signature: sha256=<–ø–æ–¥–ø–∏—Å—å>
X-Webhook-Event: task.created
X-Webhook-Timestamp: 1234567890
```

### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ (PHP)

```php
$payload = file_get_contents('php://input');
$signature = $_SERVER['HTTP_X_WEBHOOK_SIGNATURE'] ?? '';
$secret = 'your-secret-key';

$expectedSignature = 'sha256=' . hash_hmac('sha256', $payload, $secret);

if (!hash_equals($expectedSignature, $signature)) {
    http_response_code(401);
    exit('Invalid signature');
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook
$data = json_decode($payload, true);
```

## üì¶ –ü—Ä–∏–º–µ—Ä payload

### task.created
```json
{
  "event": "task.created",
  "timestamp": 1708435200,
  "data": {
    "task_id": 123,
    "title": "–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞",
    "status": "pending",
    "priority": "medium",
    "created_at": "2026-02-20T12:00:00+00:00"
  }
}
```

### task.completed
```json
{
  "event": "task.completed",
  "timestamp": 1708435200,
  "data": {
    "task_id": 123,
    "title": "–ó–∞–≤–µ—Ä—à—ë–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞",
    "completed_at": "2026-02-20T15:30:00+00:00"
  }
}
```

### deal.won
```json
{
  "event": "deal.won",
  "timestamp": 1708435200,
  "data": {
    "deal_id": 456,
    "name": "–°–¥–µ–ª–∫–∞ #456",
    "amount": 100000,
    "client": "–û–û–û –†–æ–º–∞—à–∫–∞",
    "won_at": "2026-02-20T16:00:00+00:00"
  }
}
```

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Slack

1. –°–æ–∑–¥–∞–π—Ç–µ incoming webhook –≤ Slack: https://your-workspace.slack.com/apps/manage/custom-integrations
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL webhook
3. –°–æ–∑–¥–∞–π—Ç–µ webhook –≤ CRM —Å URL –∏–∑ Slack
4. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### Telegram

1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
2. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ —á–∞—Ç/–∫–∞–Ω–∞–ª
3. –ü–æ–ª—É—á–∏—Ç–µ chat_id —á–µ—Ä–µ–∑ –±–æ—Ç–∞ @getmyid_bot
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ URL: `https://api.telegram.org/bot<token>/sendMessage`
5. –í payload —É–∫–∞–∂–∏—Ç–µ: `{"chat_id": "<chat_id>", "text": "{{data.title}}"}`

### Zapier / Make (Integromat)

1. –°–æ–∑–¥–∞–π—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–π –≤ Zapier/Make
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–∏–≥–≥–µ—Ä "Catch Hook"
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL webhook
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –≤ CRM
5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ Zapier/Make

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ webhook –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `webhook_logs`:

- `event` ‚Äî —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è
- `status_code` ‚Äî HTTP –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞
- `response_time_ms` ‚Äî –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –≤ –º—Å
- `is_success` ‚Äî —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏
- `payload` ‚Äî –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `response` ‚Äî –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞
- `error_message` ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ webhook'–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–¢–µ—Å—Ç" –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ CLI:**
```bash
php bin/console debug:router | grep webhook
```

## üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –û—Ç–ø—Ä–∞–≤–∫–∞ webhook –≤—Ä—É—á–Ω—É—é

```php
use App\Service\WebhookService;

class TaskService
{
    public function __construct(
        private WebhookService $webhookService,
    ) {}
    
    public function createTask(array $data): Task
    {
        $task = new Task();
        // ... —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ webhook
        $this->webhookService->notifyTaskCreated($task);
        
        return $task;
    }
}
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏—è

1. –î–æ–±–∞–≤—å—Ç–µ —Å–æ–±—ã—Ç–∏–µ –≤ `Webhook::getAvailableEvents()`
2. –°–æ–∑–¥–∞–π—Ç–µ –º–µ—Ç–æ–¥ –≤ `WebhookService` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `notifyTaskPriorityChanged`)
3. –í—ã–∑–æ–≤–∏—Ç–µ –º–µ—Ç–æ–¥ –≤ –Ω—É–∂–Ω–æ–º –º–µ—Å—Ç–µ –∫–æ–¥–∞

## üìù –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ wildcard —Å–æ–±—ã—Ç–∏–π (`task.*`)
- [ ] –ú–∞—Å—Å–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ webhook'–æ–≤ (batch)
- [ ] Retry –º–µ—Ö–∞–Ω–∏–∑–º —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- [ ] Dashboard —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π webhook'–æ–≤
- [ ] –®–∞–±–ª–æ–Ω—ã webhook'–æ–≤ –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] GraphQL webhook subscriptions

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–¢–∞–π–º–∞—É—Ç:** Webhook –∑–∞–ø—Ä–æ—Å—ã –∏–º–µ—é—Ç —Ç–∞–π–º–∞—É—Ç 10 —Å–µ–∫—É–Ω–¥
2. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏:** –í —Å–ª—É—á–∞–µ –Ω–µ—É–¥–∞—á–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è (TODO)
3. **–û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤:** –°—Ç–∞—Ä—ã–µ –ª–æ–≥–∏ (>30 –¥–Ω–µ–π) —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–¥–∞–ª—è—Ç—å
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ secret key –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏

## üìñ –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](docs/INTEGRATIONS.md)
- [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](docs/API.md)
- [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](docs/SECURITY.md)
