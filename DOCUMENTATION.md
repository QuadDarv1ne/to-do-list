# Документация To-Do List приложения

## Обзор проекта

To-Do List - это веб-приложение для управления задачами, разработанное на основе фреймворка Symfony 8.0. Приложение предоставляет полный набор инструментов для управления задачами, включая регистрацию пользователей, авторизацию, ролевую модель доступа и продвинутые функции управления задачами.

## Архитектура приложения

### Слои приложения

1. **Контроллеры** - Обрабатывают HTTP-запросы и возвращают ответы
2. **Сервисы** - Бизнес-логика приложения
3. **Сущности** - Модели данных
4. **Репозитории** - Операции с базой данных
5. **Шаблоны** - Представления (Twig)

### Структура директорий

```
src/
├── Controller/         # Контроллеры приложения
├── Entity/            # Сущности Doctrine
├── Repository/        # Репозитории Doctrine
├── Form/              # Формы Symfony
├── Service/           # Сервисы бизнес-логики
└── Command/           # Консольные команды

templates/
├── security/          # Шаблоны аутентификации
├── user/              # Шаблоны пользователей
├── task/              # Шаблоны задач
├── dashboard/         # Шаблоны панели управления
├── notification/      # Шаблоны уведомлений
├── registration/      # Шаблоны регистрации
└── reset_password/    # Шаблоны сброса пароля

config/
├── packages/          # Конфигурации бандлов
├── routes/            # Маршруты
└── services.yaml      # Сервисы приложения

assets/
├── controllers/       # Stimulus контроллеры
├── styles/            # Стили
└── app.js             # Основной JavaScript файл

public/
└── index.php          # Входная точка приложения
```

## Сущности приложения

### User (Пользователь)

Сущность пользователя содержит следующие поля:
- id: Идентификатор пользователя
- email: Email пользователя (уникальный)
- fullName: Полное имя пользователя
- password: Хешированный пароль
- roles: Роли пользователя (ROLE_USER, ROLE_MANAGER, ROLE_ADMIN)
- isActive: Статус активности пользователя
- lockedUntil: Время разблокировки (для блокировок за неудачные попытки входа)
- tasksAssigned: Задачи, назначенные пользователю (OneToMany)
- tasksCreatedBy: Задачи, созданные пользователем (OneToMany)
- notifications: Уведомления пользователя (OneToMany)

### Task (Задача)

Сущность задачи содержит следующие поля:
- id: Идентификатор задачи
- title: Заголовок задачи
- description: Описание задачи
- status: Статус задачи (не начата, в процессе, выполнена)
- createdAt: Дата создания
- updatedAt: Дата обновления
- deadline: Срок выполнения (опционально)
- priority: Приоритет задачи (низкий, обычный, высокий, срочный)
- assignedTo: Пользователь, которому назначена задача (ManyToOne)
- createdBy: Пользователь, создавший задачу (ManyToOne)
- notifications: Уведомления, связанные с задачей (OneToMany)

### Notification (Уведомление)

Сущность уведомления содержит следующие поля:
- id: Идентификатор уведомления
- title: Заголовок уведомления
- message: Текст уведомления
- isRead: Статус прочтения
- createdAt: Дата создания
- user: Пользователь, которому принадлежит уведомление (ManyToOne)
- task: Задача, связанная с уведомлением (ManyToOne, опционально)

### ResetPasswordRequest (Запрос сброса пароля)

Сущность запроса сброса пароля содержит следующие поля:
- id: Идентификатор запроса
- user: Пользователь, запрашивающий сброс пароля (ManyToOne)
- selector: Селектор токена
- hashedToken: Хешированный токен
- requestedAt: Время запроса
- expiresAt: Время истечения

## Контроллеры приложения

### SecurityController
Отвечает за аутентификацию пользователей:
- app_login: Страница входа
- app_logout: Выход из системы
- app_access_denied: Страница отказа в доступе

### RegistrationController
Отвечает за регистрацию новых пользователей:
- app_register: Регистрация пользователя

### ResetPasswordController
Отвечает за сброс пароля:
- app_forgot_password_request: Запрос сброса пароля
- app_check_email: Проверка email
- app_reset_password: Сброс пароля

### DashboardController
Отвечает за главную панель управления:
- app_dashboard: Панель управления с метриками

### TaskController
Отвечает за управление задачами:
- app_task_index: Список задач
- app_task_new: Создание задачи
- app_task_show: Просмотр задачи
- app_task_edit: Редактирование задачи
- app_task_delete: Удаление задачи
- app_task_toggle: Переключение статуса задачи

### UserController
Отвечает за управление пользователями:
- app_user_index: Список пользователей
- app_user_new: Создание пользователя
- app_user_show: Просмотр пользователя
- app_user_edit: Редактирование пользователя
- app_user_delete: Удаление пользователя
- app_user_toggle_active: Переключение активности
- app_user_unlock: Разблокировка пользователя

### NotificationController
Отвечает за уведомления:
- app_notification_index: Список уведомлений
- app_notification_mark_as_read: Отметить как прочитанное
- app_notification_mark_all_as_read: Отметить все как прочитанные
- app_notification_unread_count: Количество непрочитанных

### ProfileController
Отвечает за профиль пользователя:
- app_profile_show: Просмотр профиля
- app_profile_edit: Редактирование профиля
- app_profile_change_password: Смена пароля

## Безопасность

### Ролевая модель
- ROLE_USER: Обычный пользователь
- ROLE_MANAGER: Менеджер (может управлять задачами подчиненных)
- ROLE_ADMIN: Администратор (полный доступ к системе)

### Ограничения доступа
- Обычные пользователи могут видеть только свои задачи и задачи, назначенные им
- Менеджеры могут управлять задачами своих подчиненных
- Администраторы имеют полный доступ ко всем задачам и пользователям

### Защита от атак
- CSRF защита для всех форм
- Хеширование паролей
- Ограничение количества попыток входа
- Защита от повторного использования токенов сброса пароля

## Формы

### UserType
Форма для создания и редактирования пользователей:
- Email
- Полное имя
- Пароль
- Роли
- Статус активности

### TaskType
Форма для создания и редактирования задач:
- Заголовок
- Описание
- Статус
- Срок выполнения
- Приоритет
- Назначение пользователю

### ResetPasswordRequestFormType
Форма запроса сброса пароля:
- Email

### ChangePasswordFormType
Форма изменения пароля:
- Новый пароль
- Подтверждение пароля

## Сервисы

### NotificationService
Сервис для обработки уведомлений:
- Уведомления о назначении задач
- Email-уведомления
- Создание записей уведомлений

### SendDeadlineNotificationsCommand
Консольная команда для отправки уведомлений о сроках выполнения задач.

## Шаблоны

### base.html.twig
Основной шаблон приложения:
- Навигационное меню
- Система уведомлений
- Структура страницы

### Шаблоны задач
- task/index.html.twig: Список задач с фильтрами
- task/show.html.twig: Просмотр задачи
- task/form_theme.html.twig: Тема формы задачи

### Шаблоны пользователей
- user/index.html.twig: Список пользователей
- user/form.html.twig: Форма пользователя

### Шаблоны панели управления
- dashboard/index.html.twig: Главная панель управления

## Конфигурация

### База данных
Приложение поддерживает SQLite и MySQL. Конфигурация находится в `config/packages/doctrine.yaml`.

### Безопасность
Конфигурация безопасности в `config/packages/security.yaml`:
- Правила доступа
- Провайдеры аутентификации
- Защита форм

### Маршруты
Маршруты определены в `config/routes.yaml` и аннотациях контроллеров.

## Команды

### CreateAdminCommand
Консольная команда для создания администратора:
```bash
php bin/console app:create_admin
```

### SendDeadlineNotificationsCommand
Консольная команда для отправки уведомлений о сроках выполнения:
```bash
php bin/console app:send-deadline-notifications
```

## Тестирование

Приложение использует PHPUnit для модульного тестирования. Тесты находятся в директории `tests/`.

## Развертывание

### Требования
- Веб-сервер (Apache/Nginx)
- PHP 8.1+
- База данных (SQLite/MySQL)
- Composer

### Процесс развертывания
1. Загрузка кода на сервер
2. Установка зависимостей: `composer install --no-dev`
3. Настройка переменных окружения
4. Выполнение миграций: `php bin/console doctrine:migrations:migrate`
5. Установка прав на запись для директорий кеша и логов
6. Настройка веб-сервера на папку `public/`

## Миграции

Приложение использует систему миграций Doctrine. Миграции находятся в директории `migrations/`.

Для создания новой миграции:
```bash
php bin/console make:migration
```

Для выполнения миграций:
```bash
php bin/console doctrine:migrations:migrate
```

## Логирование

Приложение использует Monolog для логирования. Конфигурация находится в `config/packages/monolog.yaml`.

## Кэширование

Приложение использует встроенный механизм кэширования Symfony. Кэш очищается командой:
```bash
php bin/console cache:clear
```

## Frontend

### Стили
- Bootstrap 5 для компонентов UI
- Font Awesome для иконок
- Пользовательские стили в `assets/styles/app.css`

### JavaScript
- Stimulus для интерактивности
- Нативный JavaScript для специфичной логики
- Importmaps для управления зависимостями

## Email-уведомления

Приложение отправляет email-уведомления через Symfony Mailer. Настройки находятся в `.env` файле.

Для отправки уведомлений о сроках выполнения задач можно использовать cron:
```
0 9 * * * cd /path/to/project && php bin/console app:send-deadline-notifications
```

## Резервное копирование

Рекомендуется регулярно создавать резервные копии:
- Базы данных
- Файлов конфигурации
- Загруженных файлов (если есть)