{% extends 'base.html.twig' %}

{% block title %}Отчеты{% endblock %}

{% block body %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="h3 mb-0">
                <i class="fas fa-chart-bar me-2"></i>
                Отчеты и аналитика
            </h1>
        </div>
    </div>

    <div class="row g-4">
        <!-- Personal Productivity Report -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm hover-shadow">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="icon-box bg-primary bg-opacity-10 text-primary rounded-3 p-3 me-3">
                            <i class="fas fa-user-chart fa-2x"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-0">Личная продуктивность</h5>
                            <small class="text-muted">Ваша статистика</small>
                        </div>
                    </div>
                    <p class="card-text text-muted">
                        Анализ вашей продуктивности, скорость выполнения задач, 
                        распределение по приоритетам и дням недели.
                    </p>
                    <a href="{{ path('app_reports_productivity') }}" class="btn btn-primary w-100">
                        <i class="fas fa-chart-line me-2"></i>
                        Открыть отчет
                    </a>
                </div>
            </div>
        </div>

        {% if is_granted('ROLE_MANAGER') %}
        <!-- Team Performance Report -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm hover-shadow">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="icon-box bg-success bg-opacity-10 text-success rounded-3 p-3 me-3">
                            <i class="fas fa-users fa-2x"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-0">Эффективность команды</h5>
                            <small class="text-muted">Командная статистика</small>
                        </div>
                    </div>
                    <p class="card-text text-muted">
                        Сравнительный анализ производительности членов команды, 
                        общая статистика и рейтинг.
                    </p>
                    <a href="{{ path('app_reports_team') }}" class="btn btn-success w-100">
                        <i class="fas fa-users-cog me-2"></i>
                        Открыть отчет
                    </a>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Overdue Tasks Report -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm hover-shadow">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="icon-box bg-danger bg-opacity-10 text-danger rounded-3 p-3 me-3">
                            <i class="fas fa-exclamation-triangle fa-2x"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-0">Просроченные задачи</h5>
                            <small class="text-muted">Требуют внимания</small>
                        </div>
                    </div>
                    <p class="card-text text-muted">
                        Список всех просроченных задач с группировкой по исполнителям 
                        и количеством дней просрочки.
                    </p>
                    <a href="{{ path('app_reports_overdue') }}" class="btn btn-danger w-100">
                        <i class="fas fa-clock me-2"></i>
                        Открыть отчет
                    </a>
                </div>
            </div>
        </div>

        <!-- Analytics Dashboard -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm hover-shadow">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="icon-box bg-info bg-opacity-10 text-info rounded-3 p-3 me-3">
                            <i class="fas fa-chart-pie fa-2x"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-0">Аналитика продаж</h5>
                            <small class="text-muted">CRM метрики</small>
                        </div>
                    </div>
                    <p class="card-text text-muted">
                        Детальная аналитика продаж, конверсии, воронка продаж 
                        и ключевые показатели эффективности.
                    </p>
                    <a href="{{ path('app_analytics') }}" class="btn btn-info w-100">
                        <i class="fas fa-analytics me-2"></i>
                        Открыть аналитику
                    </a>
                </div>
            </div>
        </div>

        <!-- Export Options -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm hover-shadow">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="icon-box bg-warning bg-opacity-10 text-warning rounded-3 p-3 me-3">
                            <i class="fas fa-download fa-2x"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-0">Экспорт данных</h5>
                            <small class="text-muted">CSV, Excel, JSON</small>
                        </div>
                    </div>
                    <p class="card-text text-muted">
                        Экспорт задач и отчетов в различных форматах для 
                        дальнейшего анализа и обработки.
                    </p>
                    <a href="{{ path('app_task_index') }}?export=1" class="btn btn-warning w-100">
                        <i class="fas fa-file-export me-2"></i>
                        Экспорт задач
                    </a>
                </div>
            </div>
        </div>

        <!-- Calendar View -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm hover-shadow">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="icon-box bg-secondary bg-opacity-10 text-secondary rounded-3 p-3 me-3">
                            <i class="fas fa-calendar-alt fa-2x"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-0">Календарь задач</h5>
                            <small class="text-muted">Временная шкала</small>
                        </div>
                    </div>
                    <p class="card-text text-muted">
                        Визуализация задач на календаре с дедлайнами, 
                        встречами и важными событиями.
                    </p>
                    <a href="{{ path('app_calendar') }}" class="btn btn-secondary w-100">
                        <i class="fas fa-calendar-check me-2"></i>
                        Открыть календарь
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="row mt-5">
        <div class="col-12">
            <h4 class="mb-3">Быстрая статистика</h4>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <i class="fas fa-tasks fa-3x text-primary mb-3"></i>
                    <h3 class="mb-0">{{ app.user.tasksAssigned|length + app.user.tasksCreatedBy|length }}</h3>
                    <p class="text-muted mb-0">Всего задач</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                    <h3 class="mb-0">-</h3>
                    <p class="text-muted mb-0">Завершено</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <i class="fas fa-spinner fa-3x text-warning mb-3"></i>
                    <h3 class="mb-0">-</h3>
                    <p class="text-muted mb-0">В процессе</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <i class="fas fa-exclamation-circle fa-3x text-danger mb-3"></i>
                    <h3 class="mb-0">-</h3>
                    <p class="text-muted mb-0">Просрочено</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.hover-shadow {
    transition: all 0.3s ease;
}

.hover-shadow:hover {
    transform: translateY(-5px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
}

.icon-box {
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
}
</style>
{% endblock %}
