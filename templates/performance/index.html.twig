{% extends 'base.html.twig' %}

{% block title %}Производительность{% endblock %}

{% block body %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <h1><i class="fas fa-chart-line"></i> Производительность</h1>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="text-muted">Оценка продуктивности</h6>
                    <h2 class="text-primary">{{ metrics.productivity_score|number_format(1) }}</h2>
                    <small>/100</small>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="text-muted">Оценка эффективности</h6>
                    <h2 class="text-success">{{ metrics.efficiency_score|number_format(1) }}</h2>
                    <small>/100</small>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="text-muted">Завершено задач</h6>
                    <h2 class="text-info">{{ metrics.tasks_completed }}</h2>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="text-muted">Скорость</h6>
                    <h2 class="text-warning">{{ metrics.velocity|number_format(1) }}</h2>
                    <small>задач/день</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>Тренд производительности</h5>
                </div>
                <div class="card-body">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const trendData = {{ trend|json_encode|raw }};

const ctx = document.getElementById('trendChart').getContext('2d');
new Chart(ctx, {
    type: 'line',
    data: {
        labels: trendData.map(d => d.week),
        datasets: [{
            label: 'Оценка продуктивности',
            data: trendData.map(d => d.productivity_score),
            borderColor: 'rgb(75, 192, 192)',
            tension: 0.1
        }]
    }
});
</script>
{% endblock %}
