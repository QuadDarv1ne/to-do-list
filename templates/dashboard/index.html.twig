{% extends 'base_sidebar.html.twig' %}

{% block page_title %}–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/components/dashboard-cards.css') }}?v=4">
    <link rel="stylesheet" href="{{ asset('css/pages/dashboard-enhanced.css') }}">
{% endblock %}

{% block body %}
<div class="animate-fade-in">
    <!-- Welcome Section -->
    <div class="page-header stagger-item">
        <div class="page-header-title">
            –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ app.user.firstName }}! üëã
        </div>
        <div class="page-header-subtitle">
            –°–µ–≥–æ–¥–Ω—è {{ 'now'|date('d F Y') }} ‚Ä¢ {{ 'now'|date('H:i') }}
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="quick-stats stagger-container">
        <div class="stat-card hover-lift reveal" style="--stat-color: #10b981; --stat-bg: rgba(16, 185, 129, 0.1);" data-tooltip="–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –≤ —Å–∏—Å—Ç–µ–º–µ">
            <div class="stat-header">
                <div class="stat-icon">
                    <i class="fas fa-tasks"></i>
                </div>
                <div class="stat-trend up">
                    <i class="fas fa-arrow-up"></i>
                    <span>12%</span>
                </div>
            </div>
            <div class="stat-value counter">{{ task_stats.total|default(24) }}</div>
            <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</div>
            <div class="progress-bar-container">
                <div class="progress-bar progress-animated" style="width: 75%; background: linear-gradient(90deg, #10b981, #059669);"></div>
            </div>
        </div>

        <div class="stat-card hover-lift reveal" style="--stat-color: #f59e0b; --stat-bg: rgba(245, 158, 11, 0.1);" data-tooltip="–ó–∞–¥–∞—á–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è">
            <div class="stat-header">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-trend up">
                    <i class="fas fa-arrow-up"></i>
                    <span>8%</span>
                </div>
            </div>
            <div class="stat-value counter">{{ task_stats.in_progress|default(8) }}</div>
            <div class="stat-label">–í —Ä–∞–±–æ—Ç–µ</div>
            <div class="progress-bar-container">
                <div class="progress-bar progress-animated" style="width: 60%; background: linear-gradient(90deg, #f59e0b, #d97706);"></div>
            </div>
        </div>

        <div class="stat-card hover-lift reveal" style="--stat-color: #6366f1; --stat-bg: rgba(99, 102, 241, 0.1);" data-tooltip="–£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏">
            <div class="stat-header">
                <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-trend up">
                    <i class="fas fa-arrow-up"></i>
                    <span>15%</span>
                </div>
            </div>
            <div class="stat-value counter">{{ task_stats.completed|default(12) }}</div>
            <div class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
            <div class="progress-bar-container">
                <div class="progress-bar progress-animated" style="width: 85%; background: linear-gradient(90deg, #6366f1, #4f46e5);"></div>
            </div>
        </div>

        <div class="stat-card hover-lift reveal" style="--stat-color: #ef4444; --stat-bg: rgba(239, 68, 68, 0.1);" data-tooltip="–ó–∞–¥–∞—á–∏ —Å –∏—Å—Ç—ë–∫—à–∏–º —Å—Ä–æ–∫–æ–º">
            <div class="stat-header">
                <div class="stat-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-trend down">
                    <i class="fas fa-arrow-down"></i>
                    <span>5%</span>
                </div>
            </div>
            <div class="stat-value counter">{{ task_stats.overdue|default(4) }}</div>
            <div class="stat-label">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</div>
            <div class="progress-bar-container">
                <div class="progress-bar progress-animated" style="width: 30%; background: linear-gradient(90deg, #ef4444, #dc2626);"></div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard Grid -->
    <div class="dashboard-grid">
        <!-- Charts Section -->
        <div class="col-span-8">
            <div class="card-enhanced stagger-item delay-400">
                <div class="card-header-enhanced">
                    <h3 class="card-title">
                        <i class="fas fa-chart-line me-2"></i>
                        –î–∏–Ω–∞–º–∏–∫–∞ –∑–∞–¥–∞—á
                    </h3>
                    <div class="chart-filter">
                        <button class="filter-btn">–î–µ–Ω—å</button>
                        <button class="filter-btn">–ù–µ–¥–µ–ª—è</button>
                        <button class="filter-btn active">–ú–µ—Å—è—Ü</button>
                        <button class="filter-btn">–ì–æ–¥</button>
                    </div>
                </div>
                <canvas id="tasksChart" height="80"></canvas>
            </div>

            <!-- Recent Activity -->
            <div class="card-enhanced stagger-item delay-500 mt-3">
                <div class="card-header-enhanced">
                    <h3 class="card-title">
                        <i class="fas fa-history me-2"></i>
                        –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
                    </h3>
                    <div class="card-actions">
                        <button class="btn-icon" title="–û–±–Ω–æ–≤–∏—Ç—å">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>

                <div class="activity-list">
                    {% for i in 1..5 %}
                    <div class="activity-item animate-fade-in-left delay-{{ i * 100 }}">
                        <div class="activity-icon gradient-{{ cycle(['success', 'primary', 'warning', 'purple', 'danger'], i) }}">
                            <i class="fas fa-{{ cycle(['check', 'plus', 'comment', 'user-plus', 'exclamation'], i) }}"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å {{ i }}</div>
                            <div class="activity-time">{{ i * 15 }} –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-span-4">
            <!-- Quick Tasks -->
            <div class="card-enhanced stagger-item delay-500">
                <div class="card-header-enhanced">
                    <h3 class="card-title">
                        <i class="fas fa-bolt me-2"></i>
                        –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–¥–∞—á–∏
                    </h3>
                    <a href="{{ path('app_task_new') }}" class="btn-icon" title="–î–æ–±–∞–≤–∏—Ç—å">
                        <i class="fas fa-plus"></i>
                    </a>
                </div>

                <div class="task-list-mini">
                    {% for i in 1..5 %}
                    <div class="task-item-mini">
                        <div class="task-checkbox"></div>
                        <div class="task-title-mini">–ó–∞–¥–∞—á–∞ {{ i }}</div>
                        <div class="task-priority priority-{{ cycle(['high', 'medium', 'low'], i) }}"></div>
                    </div>
                    {% endfor %}
                </div>

                <a href="{{ path('app_task_index') }}" class="btn btn-gradient-primary w-100 mt-3">
                    <i class="fas fa-list me-2"></i>
                    –í—Å–µ –∑–∞–¥–∞—á–∏
                </a>
            </div>

            <!-- Calendar Widget -->
            <div class="card-enhanced stagger-item delay-600 mt-3">
                <div class="card-header-enhanced">
                    <h3 class="card-title">
                        <i class="fas fa-calendar me-2"></i>
                        –ö–∞–ª–µ–Ω–¥–∞—Ä—å
                    </h3>
                </div>
                <div class="calendar-mini">
                    <div class="calendar-header">
                        <button class="calendar-nav-btn"><i class="fas fa-chevron-left"></i></button>
                        <span>{{ 'now'|date('F Y') }}</span>
                        <button class="calendar-nav-btn"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <div class="calendar-grid-mini">
                        {% for day in ['–ü–ù', '–í–¢', '–°–†', '–ß–¢', '–ü–¢', '–°–ë', '–í–°'] %}
                        <div class="calendar-day-header">{{ day }}</div>
                        {% endfor %}
                        {% for day in 1..31 %}
                        <div class="calendar-day {% if day == 'now'|date('d') %}today{% endif %}">{{ day }}</div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Tasks Table -->
        <div class="col-span-12">
            <div class="card-enhanced stagger-item delay-700">
                <div class="card-header-enhanced">
                    <h3 class="card-title">
                        <i class="fas fa-tasks me-2"></i>
                        –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–¥–∞—á–∏
                    </h3>
                    <a href="{{ path('app_task_index') }}" class="btn btn-gradient-primary">
                        –í—Å–µ –∑–∞–¥–∞—á–∏
                    </a>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–°—Ä–æ–∫</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for task in recent_tasks|default([]) %}
                            <tr onclick="window.location.href='{{ path('app_task_show', {id: task.id}) }}'" style="cursor: pointer;">
                                <td>{{ task.id }}</td>
                                <td>{{ task.title }}</td>
                                <td>
                                    <span class="badge badge-gradient-{{ task.priority == 'high' ? 'danger' : (task.priority == 'medium' ? 'warning' : 'success') }}">
                                        {{ task.priority|upper }}
                                    </span>
                                </td>
                                <td>
                                    <span class="badge badge-gradient-{{ task.status == 'completed' ? 'success' : (task.status == 'in_progress' ? 'primary' : 'info') }}">
                                        {{ task.status }}
                                    </span>
                                </td>
                                <td>{{ task.dueDate ? task.dueDate|date('d.m.Y') : '-' }}</td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="5" class="text-center text-muted">–ù–µ—Ç –∑–∞–¥–∞—á</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Task checkboxes animation
document.querySelectorAll('.task-checkbox').forEach(checkbox => {
    checkbox.addEventListener('click', function() {
        this.classList.toggle('checked');
        const taskItem = this.closest('.task-item-mini');
        if (this.classList.contains('checked')) {
            taskItem.style.opacity = '0.6';
            taskItem.querySelector('.task-title-mini').style.textDecoration = 'line-through';
        } else {
            taskItem.style.opacity = '1';
            taskItem.querySelector('.task-title-mini').style.textDecoration = 'none';
        }
    });
});
</script>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="{{ asset('js/components/dashboard-interactions.js') }}"></script>
    <script>
        // Tasks Chart
        const tasksCtx = document.getElementById('tasksChart').getContext('2d');
        new Chart(tasksCtx, {
            type: 'line',
            data: {
                labels: ['–ü–ù', '–í–¢', '–°–†', '–ß–¢', '–ü–¢', '–°–ë', '–í–°'],
                datasets: [{
                    label: '–ó–∞–≤–µ—Ä—à–µ–Ω–æ',
                    data: [12, 19, 15, 25, 22, 30, 28],
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 3
                }, {
                    label: '–°–æ–∑–¥–∞–Ω–æ',
                    data: [8, 12, 10, 15, 14, 18, 16],
                    borderColor: '#6366f1',
                    backgroundColor: 'rgba(99, 102, 241, 0.1)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
{% endblock %}
