{% extends 'base.html.twig' %}

{% block title %}Календарь{% endblock %}

{% block body %}
<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="fas fa-calendar-alt"></i> Календарь задач</h1>
        <div>
            <a href="{{ path('app_calendar_upcoming') }}" class="btn btn-info">
                <i class="fas fa-clock"></i> Ближайшие дедлайны
            </a>
            <a href="{{ path('app_calendar_export') }}" class="btn btn-success">
                <i class="fas fa-download"></i> Экспорт в iCal
            </a>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div id="calendar"></div>
        </div>
    </div>
</div>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/locales/ru.global.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const calendarEl = document.getElementById('calendar');
    
    const calendar = new FullCalendar.Calendar(calendarEl, {
        locale: 'ru',
        initialView: 'dayGridMonth',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
        },
        buttonText: {
            today: 'Сегодня',
            month: 'Месяц',
            week: 'Неделя',
            day: 'День',
            list: 'Список'
        },
        events: '{{ path('app_calendar_events') }}',
        eventClick: function(info) {
            info.jsEvent.preventDefault();
            if (info.event.url) {
                window.location.href = info.event.url;
            }
        },
        eventDidMount: function(info) {
            // Add tooltip
            info.el.title = info.event.title + '\n' +
                'Приоритет: ' + info.event.extendedProps.priority + '\n' +
                'Статус: ' + info.event.extendedProps.status;
        },
        height: 'auto',
        firstDay: 1, // Monday
        weekNumbers: true,
        weekText: 'Нед',
        allDayText: 'Весь день',
        noEventsText: 'Нет задач для отображения'
    });
    
    calendar.render();
});
</script>

<style>
#calendar {
    max-width: 100%;
    margin: 0 auto;
}

.fc-event {
    cursor: pointer;
}

.fc-event:hover {
    opacity: 0.8;
}
</style>
{% endblock %}
