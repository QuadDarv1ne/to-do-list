{% extends 'auth_base.html.twig' %}

{% block title %}Регистрация{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/pages/auth-enhanced.css') }}">
{% endblock %}

{% block body %}
<div class="register-container">
    <div class="register-header">
        <div class="register-icon">
            <i class="fas fa-user-plus"></i>
        </div>
        <h2>Создать аккаунт</h2>
        <p>CRM система: Анализ продаж</p>
    </div>
    
    <div class="register-body">
        {% if registration_form.vars.errors|length > 0 %}
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-circle"></i>
                {{ form_errors(registration_form) }}
            </div>
        {% endif %}
        
        {% for flash_error in app.flashes('verify_email_error') %}
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-circle"></i>
                {{ flash_error }}
            </div>
        {% endfor %}
        
        {{ form_start(registration_form, {'attr': {'novalidate': 'novalidate'}}) }}
        
        <div class="row">
            <div class="col-half">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-user"></i>
                        Имя
                    </label>
                    {{ form_widget(registration_form.firstName, {
                        'attr': {'class': 'form-control', 'placeholder': 'Иван'}
                    }) }}
                    {{ form_errors(registration_form.firstName) }}
                </div>
            </div>
            <div class="col-half">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-user"></i>
                        Фамилия
                    </label>
                    {{ form_widget(registration_form.lastName, {
                        'attr': {'class': 'form-control', 'placeholder': 'Иванов'}
                    }) }}
                    {{ form_errors(registration_form.lastName) }}
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-id-badge"></i>
                Логин
            </label>
            {{ form_widget(registration_form.username, {
                'attr': {'class': 'form-control', 'placeholder': 'ivanov'}
            }) }}
            {{ form_errors(registration_form.username) }}
        </div>
        
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-envelope"></i>
                Email
            </label>
            {{ form_widget(registration_form.email, {
                'attr': {'class': 'form-control', 'placeholder': 'ivanov@dvfarm.ru', 'type': 'email'}
            }) }}
            {{ form_errors(registration_form.email) }}
        </div>
        
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-lock"></i>
                Пароль
            </label>
            <div class="password-wrapper">
                {{ form_widget(registration_form.plainPassword.first, {
                    'attr': {'class': 'form-control', 'placeholder': 'Минимум 8 символов', 'id': 'password-first'}
                }) }}
                <i class="fas fa-eye password-toggle" data-target="password-first"></i>
            </div>
            {{ form_errors(registration_form.plainPassword.first) }}
        </div>
        
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-lock"></i>
                Подтверждение пароля
            </label>
            <div class="password-wrapper">
                {{ form_widget(registration_form.plainPassword.second, {
                    'attr': {'class': 'form-control', 'placeholder': 'Повторите пароль', 'id': 'password-second'}
                }) }}
                <i class="fas fa-eye password-toggle" data-target="password-second"></i>
            </div>
            {{ form_errors(registration_form.plainPassword.second) }}
        </div>
        
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-phone"></i>
                Телефон
            </label>
            {{ form_widget(registration_form.phone, {
                'attr': {'class': 'form-control', 'placeholder': '+7 (999) 123-45-67'}
            }) }}
            {{ form_errors(registration_form.phone) }}
        </div>
        
        <div class="row">
            <div class="col-half">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-briefcase"></i>
                        Должность
                    </label>
                    {{ form_widget(registration_form.position, {
                        'attr': {'class': 'form-control', 'placeholder': 'Менеджер'}
                    }) }}
                    {{ form_errors(registration_form.position) }}
                </div>
            </div>
            <div class="col-half">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-building"></i>
                        Отдел
                    </label>
                    {{ form_widget(registration_form.department, {
                        'attr': {'class': 'form-control', 'placeholder': 'Продажи'}
                    }) }}
                    {{ form_errors(registration_form.department) }}
                </div>
            </div>
        </div>
        
        <button type="submit" class="btn-register">
            <span>
                <i class="fas fa-user-plus me-2"></i>
                Зарегистрироваться
            </span>
        </button>
        
        {{ form_end(registration_form) }}
        
        <div class="register-footer">
            <p>Уже есть аккаунт?</p>
            <a href="{{ path('app_login') }}">
                <i class="fas fa-sign-in-alt"></i>
                Войти в систему
            </a>
        </div>
    </div>
</div>

<script>
document.querySelectorAll('.password-toggle').forEach(toggle => {
    toggle.addEventListener('click', function() {
        const targetId = this.getAttribute('data-target');
        const input = document.getElementById(targetId);
        
        if (input) {
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);
            
            this.classList.toggle('fa-eye');
            this.classList.toggle('fa-eye-slash');
        }
    });
});

document.querySelectorAll('.form-control').forEach(input => {
    input.addEventListener('focus', function() {
        this.parentElement.style.transform = 'scale(1.02)';
        this.parentElement.style.transition = 'transform 0.3s ease';
    });
    
    input.addEventListener('blur', function() {
        this.parentElement.style.transform = 'scale(1)';
    });
});
</script>
{% endblock %}
