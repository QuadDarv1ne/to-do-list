---
inclusion: always
---

# Task Management System - Инструкции для разработки

## КРИТИЧЕСКИЕ ПРАВИЛА РАБОТЫ

### Документация и коммуникация
- НЕ создавать документацию без явного запроса пользователя
- Отвечать на русском языке если пользователь пишет по-русски
- Кратко резюмировать - что сделано (максимум 2-3 предложения)
- НЕ писать длинные резюме с bullet points

### Анализ кода перед изменениями
- ВСЕГДА проверять код перед изменениями (readCode/readFile)
- Использовать getDiagnostics для проверки после изменений
- Проверять зависимости - найти связанные файлы
- Понимать контекст перед внесением изменений

### Управление файлами и процессами
- НИКОГДА не удалять файлы без разрешения пользователя
- ВСЕГДА спрашивать перед удалением любых файлов
- Закрывать неиспользуемые фоновые процессы для чистоты системы
- Мониторить активные процессы и их состояние

### Фокус на задаче
- НЕ добавлять тесты автоматически
- Точечные изменения - минимум кода для решения задачи
- Исправлять только то, что требуется
- Избегать избыточных изменений
- НЕ создавать новые файлы, если изменения можно добавить в существующие
- Использовать существующую структуру файлов максимально эффективно

## АРХИТЕКТУРА ПРОЕКТА

### Технологический стек
- Backend: Symfony 7.x (PHP 8.2+)
- Database: PostgreSQL
- ORM: Doctrine
- Messaging: Symfony Messenger
- Frontend: Stimulus.js + Turbo + Asset Mapper
- Authentication: Symfony Security + 2FA (scheb/2fa-bundle)
- Styling: Custom CSS (dark theme support)

### DDD структура
```
src/
├── Domain/           # Бизнес-логика, сущности, события
├── Application/      # Use cases, команды, обработчики
└── Infrastructure/   # Репозитории, сервисы, контроллеры
```

### Основные сущности
- User - пользователи с ролями (ROLE_USER, ROLE_ADMIN)
- Task - задачи с приоритетами и статусами
- Project - проекты для группировки задач
- Team - команды пользователей
- Comment - комментарии к задачам
- Notification - уведомления пользователей

## ПРИОРИТЕТЫ ПРИ РАБОТЕ

### 1. Исправление ошибок (высший приоритет)
- Проверять getDiagnostics для файлов после изменений
- Искать и исправлять баги в существующем коде
- Проверять логику в контроллерах и сервисах
- Исправлять синтаксические ошибки в Twig и YAML

### 2. Оптимизация кода
- Удалять дублирующийся код
- Оптимизировать запросы к БД (избегать N+1 проблем)
- Улучшать производительность
- Рефакторинг сложных методов

### 3. UI/UX улучшения
- Проверять шаблоны Twig на консистентность
- Улучшать пользовательский опыт
- Поддерживать различные темы
- Обеспечивать отзывчивость интерфейса

### 4. Безопасность
- Проверять права доступа (voters, security)
- Валидация входных данных
- CSRF защита в формах
- Проверка аутентификации и авторизации

## ЧТО ПРОВЕРЯТЬ ПЕРЕД ИЗМЕНЕНИЯМИ

### Backend (приоритет)
- Контроллеры (src/Infrastructure/Controller/)
- Сервисы (src/Infrastructure/Service/)
- Репозитории (src/Infrastructure/Repository/)
- Формы (src/Infrastructure/Form/)
- Команды и обработчики (src/Application/)
- Сущности (src/Domain/Entity/)
- Маршруты (config/routes/)

### Frontend
- Stimulus контроллеры (assets/controllers/)
- JavaScript (public/js/)
- Стили (assets/styles/, public/css/)
- Шаблоны Twig (templates/)

### Database
- Миграции (migrations/)
- Конфигурация Doctrine (config/packages/doctrine.yaml)

### Configuration
- Services (config/services.yaml)
- Security (config/packages/security.yaml)
- Packages (config/packages/)

## ПОЛЕЗНЫЕ КОМАНДЫ

### Проверка кода (использовать регулярно)
```bash
# Проверка синтаксиса Twig
php bin/console lint:twig templates/

# Проверка синтаксиса YAML
php bin/console lint:yaml config/

# Проверка схемы БД
php bin/console doctrine:schema:validate
```

### База данных
```bash
# Создание миграции
php bin/console make:migration

# Применение миграций
php bin/console doctrine:migrations:migrate

# Загрузка фикстур
php bin/console doctrine:fixtures:load
```

### Разработка
```bash
# Запуск dev сервера
php -S localhost:8000 -t public

# Очистка кэша
php bin/console cache:clear

# Обработка очереди
php bin/console messenger:consume async
```

## ТЕКУЩЕЕ СОСТОЯНИЕ ПРОЕКТА

### Реализованный функционал
- Регистрация и аутентификация пользователей
- Двухфакторная аутентификация (2FA)
- CRUD операции для задач
- Проекты и команды
- Комментарии к задачам
- Система уведомлений
- Drag & Drop для задач
- Быстрое создание задач
- Темная тема
- PWA поддержка

### Известные особенности
- Используется Asset Mapper вместо Webpack
- Turbo для SPA-like навигации
- Messenger для асинхронных задач
- Supervisor для обработки очередей (в продакшене)

### Система тем оформления
Проект использует двухуровневую систему тем с поддержкой 5 цветовых схем:

#### Типы layout
1. **Sidebar Layout** (base_sidebar.html.twig) - для дашборда
   - Боковое меню слева
   - Структура: public/css/themes/sidebar-layout.css (общие стили)
   - Темы: public/css/themes/sidebar-theme-*.css (цвета для каждой темы)

2. **Topbar Layout** (base.html.twig) - для остальных страниц
   - Верхнее меню
   - Структура: public/css/themes/topbar-layout.css (общие стили)
   - Темы: public/css/themes/topbar-theme-*.css (цвета для каждой темы)

#### Доступные темы (5 вариантов)
1. **Light** (светлая) - по умолчанию
   - Файлы: sidebar-theme-light.css, topbar-theme-light.css
   
2. **Dark** (тёмная)
   - Файлы: sidebar-theme-dark.css, topbar-theme-dark.css
   
3. **Orange** (оранжевая)
   - Файлы: sidebar-theme-orange.css, topbar-theme-orange.css
   
4. **Purple** (фиолетовая)
   - Файлы: sidebar-theme-purple.css, topbar-theme-purple.css
   
5. **Custom** (настраиваемая пользователем)
   - Файлы: sidebar-theme-custom.css, topbar-theme-custom.css
   - Пользователь может регулировать цвета через настройки

#### Управление темами
- Layout файлы: sidebar-layout.css, topbar-layout.css (общие стили структуры)
- Файлы тем: sidebar-theme-{color}.css, topbar-theme-{color}.css (цветовые схемы)
- JavaScript: public/js/core/theme-manager-enhanced.js
- Выбор темы сохраняется в localStorage
- Переключение через кнопки в sidebar footer или FAB меню

## WORKFLOW ПРИ РАБОТЕ

1. Понять запрос - уточнить, если неясно
2. Изучить код - использовать readCode для понимания контекста
3. Проверить зависимости - найти связанные файлы
4. Внести изменения - точечно и минимально
5. Проверить результат - использовать getDiagnostics
6. Кратко резюмировать - что сделано (2-3 предложения)

## ЗАПРЕЩЕННЫЕ ДЕЙСТВИЯ

### Документация
- Не создавать markdown файлы с документацией
- Не писать длинные резюме с bullet points
- Не создавать файлы README без запроса

### Файлы и код
- Не удалять файлы без разрешения пользователя
- Не добавлять тесты автоматически
- Не удалять код без проверки использования
- Не делать избыточные изменения

### Система
- Не оставлять неиспользуемые процессы запущенными
- Не игнорировать ошибки в логах
- Не пропускать проверку getDiagnostics после изменений