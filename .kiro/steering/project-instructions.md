---
inclusion: always
---

# Инструкции по работе с проектом Task Management System

## Критические правила работы
- **НЕ создавать документацию** без явного запроса пользователя
- **НЕ делать массовые изменения** без предварительной проверки
- **Всегда проверять код** перед внесением изменений (использовать readCode/readFile)
- **Удалять файлы** только после проверки их использования в проекте
- **Отвечать на русском языке** если пользователь пишет по-русски
- **Минимальные изменения** - делать только то, что запрошено

## Архитектура проекта

### Технологический стек
- **Backend**: Symfony 7.x (PHP 8.2+)
- **Database**: PostgreSQL
- **ORM**: Doctrine
- **Messaging**: Symfony Messenger
- **Frontend**: Stimulus.js + Turbo + Asset Mapper
- **Authentication**: Symfony Security + 2FA (scheb/2fa-bundle)
- **Styling**: Custom CSS (dark theme support)

### DDD структура
```
src/
├── Domain/           # Бизнес-логика, сущности, события
├── Application/      # Use cases, команды, обработчики
└── Infrastructure/   # Репозитории, сервисы, контроллеры
```

### Основные сущности
- **User** - пользователи с ролями (ROLE_USER, ROLE_ADMIN)
- **Task** - задачи с приоритетами и статусами
- **Project** - проекты для группировки задач
- **Team** - команды пользователей
- **Comment** - комментарии к задачам
- **Notification** - уведомления пользователей

## Приоритеты при работе

### 1. Исправление ошибок
- Проверять getDiagnostics для файлов после изменений
- Искать и исправлять баги в существующем коде
- Проверять логику в контроллерах и сервисах

### 2. Оптимизация кода
- Удалять дублирующийся код
- Оптимизировать запросы к БД (N+1 проблемы)
- Улучшать производительность

### 3. UI/UX улучшения
- Проверять шаблоны Twig на консистентность
- Улучшать пользовательский опыт
- Поддерживать темную тему

### 4. Безопасность
- Проверять права доступа (voters, security)
- Валидация входных данных
- CSRF защита в формах

## Что проверять перед изменениями

### Backend
- **Контроллеры** (`src/Infrastructure/Controller/`)
- **Сервисы** (`src/Infrastructure/Service/`)
- **Репозитории** (`src/Infrastructure/Repository/`)
- **Формы** (`src/Infrastructure/Form/`)
- **Команды и обработчики** (`src/Application/`)
- **Сущности** (`src/Domain/Entity/`)
- **Маршруты** (`config/routes/`)

### Frontend
- **Stimulus контроллеры** (`assets/controllers/`)
- **JavaScript** (`public/js/`)
- **Стили** (`assets/styles/`, `public/css/`)
- **Шаблоны Twig** (`templates/`)

### Database
- **Миграции** (`migrations/`)
- **Конфигурация Doctrine** (`config/packages/doctrine.yaml`)

### Configuration
- **Services** (`config/services.yaml`)
- **Security** (`config/packages/security.yaml`)
- **Packages** (`config/packages/`)

## Полезные команды

### Проверка кода
```bash
# Проверка синтаксиса PHP
php bin/console lint:twig templates/
php bin/console lint:yaml config/

# Проверка схемы БД
php bin/console doctrine:schema:validate
```

### База данных
```bash
# Создание миграции
php bin/console make:migration

# Применение миграций
php bin/console doctrine:migrations:migrate

# Загрузка фикстур
php bin/console doctrine:fixtures:load
```

### Разработка
```bash
# Запуск dev сервера
symfony server:start

# Очистка кэша
php bin/console cache:clear
```

## Текущее состояние проекта

### Реализованный функционал
- ✅ Регистрация и аутентификация пользователей
- ✅ Двухфакторная аутентификация (2FA)
- ✅ CRUD операции для задач
- ✅ Проекты и команды
- ✅ Комментарии к задачам
- ✅ Система уведомлений
- ✅ Drag & Drop для задач
- ✅ Быстрое создание задач
- ✅ Темная тема
- ✅ PWA поддержка

### Известные особенности
- Используется Asset Mapper вместо Webpack
- Turbo для SPA-like навигации
- Messenger для асинхронных задач
- Supervisor для обработки очередей (в продакшене)

## Workflow при работе

1. **Понять запрос** - уточнить, если неясно
2. **Изучить код** - использовать readCode для понимания контекста
3. **Проверить зависимости** - найти связанные файлы
4. **Внести изменения** - минимально и точечно
5. **Проверить результат** - использовать getDiagnostics
6. **Кратко резюмировать** - что сделано (2-3 предложения)

## Что НЕ делать
- ❌ Не создавать markdown файлы с документацией
- ❌ Не делать массовый рефакторинг без запроса
- ❌ Не удалять код без проверки использования
- ❌ Не добавлять тесты автоматически
- ❌ Не писать длинные резюме с bullet points
