# Требования: CRM-система «Анализ продаж» для ООО «Дальневосточный фермер»

## 1. Обзор проекта

CRM-система для анализа продаж, разработанная на Symfony 7.x для автоматизации процессов управления продажами, клиентами и аналитики для компании ООО «Дальневосточный фермер».

### Текущее состояние
- ✅ Базовая система управления задачами (Tasks)
- ✅ Система целей (Goals/OKR)
- ✅ Трекинг привычек (Habits)
- ✅ Аутентификация с 2FA
- ✅ Базовый dashboard с виджетами
- ✅ Аналитика и отчёты
- ✅ Команды и проекты

### Что нужно добавить
Расширение функциональности для полноценной CRM-системы с модулями продаж, клиентов, товаров, воронки продаж и интеграций.

## 2. Пользовательские истории

### 2.1 Модуль "Продажи и сделки"

**US-2.1.1: Управление сделками**
Как менеджер по продажам, я хочу создавать и управлять сделками, чтобы отслеживать процесс продажи от начала до завершения.

Критерии приёмки:
- Создание сделки с полями: название, клиент, менеджер, сумма, статус, даты
- Редактирование и удаление сделок
- Просмотр детальной информации по сделке
- История изменений сделки (кто, когда, что изменил)
- Статусы: "В работе", "Успешно завершена", "Проиграна", "Отложена"

**US-2.1.2: Воронка продаж**
Как руководитель, я хочу видеть воронку продаж, чтобы понимать на каком этапе находятся сделки и где происходят потери.

Критерии приёмки:
- Визуализация воронки с этапами: Лид → Квалификация → Предложение → Переговоры → Закрытие
- Количество сделок и сумма на каждом этапе
- Процент конверсии между этапами
- Возможность перетаскивания сделок между этапами (drag-and-drop)
- Фильтрация по менеджерам и периодам

**US-2.1.3: Планирование продаж**
Как руководитель, я хочу устанавливать плановые показатели, чтобы контролировать выполнение плана продаж.

Критерии приёмки:
- Установка месячного плана для компании
- Установка индивидуальных планов для менеджеров
- Отображение факт/план в процентах
- Уведомления при выполнении/невыполнении плана
- История планов по месяцам

### 2.2 Модуль "Клиенты"

**US-2.2.1: База клиентов**
Как менеджер, я хочу вести единую базу клиентов, чтобы хранить всю информацию о контрагентах в одном месте.

Критерии приёмки:
- CRUD операции для клиентов
- Поля: название организации, ИНН, КПП, контактное лицо, телефон, email, адрес
- Сегментация: розница/опт
- Категория: постоянный, новый, VIP, потенциальный
- Привязка менеджера к клиенту
- Поиск и фильтрация клиентов

**US-2.2.2: История взаимодействий**
Как менеджер, я хочу видеть всю историю работы с клиентом, чтобы понимать контекст отношений.

Критерии приёмки:
- Список всех сделок клиента
- Хронология контактов (звонки, встречи, письма)
- Комментарии и заметки менеджеров
- Прикрепление файлов (договоры, счета)
- Временная шкала событий

**US-2.2.3: Аналитика по клиентам**
Как руководитель, я хочу видеть статистику по клиентам, чтобы выявлять наиболее ценных покупателей.

Критерии приёмки:
- ТОП-5 клиентов по выручке
- Динамика закупок клиента (график)
- Средний чек клиента
- Частота покупок
- RFM-анализ (Recency, Frequency, Monetary)
- Последняя активность клиента

### 2.3 Модуль "Товары и склад"

**US-2.3.1: Каталог товаров**
Как администратор, я хочу управлять каталогом товаров, чтобы актуализировать ассортимент.

Критерии приёмки:
- CRUD операции для товаров
- Поля: название, артикул, категория, единица измерения, цена, остаток
- Категории товаров (иерархия)
- Изображения товаров
- Импорт товаров из Excel/CSV

**US-2.3.2: Учёт остатков**
Как менеджер, я хочу видеть актуальные остатки товаров, чтобы не продавать то, чего нет на складе.

Критерии приёмки:
- Автоматическое списание при завершении сделки
- Ручная корректировка остатков (с указанием причины)
- Уведомления при низких остатках (настраиваемый порог)
- История движения товара
- Резервирование товара под сделку

**US-2.3.3: Аналитика по товарам**
Как руководитель, я хочу анализировать продажи товаров, чтобы оптимизировать ассортимент.

Критерии приёмки:
- ТОП-5 товаров по выручке и количеству
- Динамика продаж по товарным группам
- ABC-анализ товаров
- Сезонные колебания (график по месяцам)
- Товары с низкой оборачиваемостью

### 2.4 Модуль "Расширенная аналитика"

**US-2.4.1: Дашборд руководителя**
Как руководитель, я хочу видеть ключевые показатели на одном экране, чтобы быстро оценивать ситуацию.

Критерии приёмки:
- Виджет "Выручка" (сегодня, неделя, месяц) с динамикой
- График продаж с возможностью сравнения периодов
- ТОП-5 товаров и клиентов
- Рейтинг эффективности менеджеров (план/факт)
- Количество просроченных задач
- График активности клиентов (новые клиенты/заказы)
- Настройка виджетов (drag-and-drop)

**US-2.4.2: Дашборд менеджера**
Как менеджер, я хочу видеть свои личные показатели, чтобы контролировать выполнение плана.

Критерии приёмки:
- Мой план/факт за месяц
- Мои текущие сделки в работе
- Мои задачи на сегодня
- Мои клиенты (активные, новые)
- Моя статистика (количество сделок, средний чек, конверсия)

**US-2.4.3: Сравнение периодов**
Как руководитель, я хочу сравнивать показатели за разные периоды, чтобы видеть тренды.

Критерии приёмки:
- Выбор двух произвольных периодов для сравнения
- Отображение на одном графике
- Процент изменения между периодами
- Быстрые варианты: текущий vs прошлый месяц, год к году
- Сравнение по менеджерам, товарам, клиентам

### 2.5 Модуль "Отчёты"

**US-2.5.1: Генерация отчётов**
Как руководитель, я хочу формировать отчёты по различным параметрам, чтобы анализировать данные.

Критерии приёмки:
- Отчёт по продажам (период, менеджер, товар, клиент)
- Отчёт по выполнению плана (менеджеры)
- Отчёт по просроченным задачам
- Отчёт по клиентам (активность, задолженность)
- Отчёт по товарам (остатки, оборачиваемость)
- Выгрузка в PDF, Excel, CSV

**US-2.5.2: Автоматическая рассылка**
Как руководитель, я хочу настроить автоматическую отправку отчётов, чтобы получать их регулярно.

Критерии приёмки:
- Настройка расписания (ежедневно, еженедельно, ежемесячно)
- Выбор типа отчёта и параметров
- Список получателей (email)
- Формат отчёта (PDF/Excel)
- История отправленных отчётов

### 2.6 Модуль "Уведомления"

**US-2.6.1: Внутренние уведомления**
Как пользователь, я хочу получать уведомления о важных событиях, чтобы не пропустить их.

Критерии приёмки:
- Уведомления в интерфейсе (колокольчик)
- Типы: задача просрочена, сделка изменена, новый клиент, низкий остаток
- Счётчик непрочитанных уведомлений
- Возможность отметить как прочитанное
- История уведомлений

**US-2.6.2: Email-уведомления**
Как руководитель, я хочу получать email при критических событиях, чтобы оперативно реагировать.

Критерии приёмки:
- Падение продаж более чем на X% за период
- Превышение/невыполнение плана менеджером
- Крупная сделка (сумма > X)
- Низкие остатки товара
- Настройка пороговых значений
- Возможность отключить уведомления

**US-2.6.3: Настраиваемые правила**
Как администратор, я хочу создавать собственные правила уведомлений, чтобы адаптировать систему под бизнес-процессы.

Критерии приёмки:
- Конструктор правил: условие → действие
- Условия: изменение статуса, превышение суммы, истечение срока
- Действия: отправить email, создать задачу, показать уведомление
- Активация/деактивация правил
- Тестирование правил

### 2.7 Модуль "Интеграции"

**US-2.7.1: Интеграция с 1С**
Как администратор, я хочу настроить обмен данными с 1С, чтобы синхронизировать информацию.

Критерии приёмки:
- REST API для обмена данными
- Импорт товаров из 1С
- Импорт клиентов из 1С
- Экспорт заказов в 1С
- Логирование обмена данными
- Обработка ошибок синхронизации

**US-2.7.2: Импорт/экспорт данных**
Как администратор, я хочу загружать и выгружать данные через Excel/CSV, чтобы быстро обновлять справочники.

Критерии приёмки:
- Импорт клиентов из Excel/CSV
- Импорт товаров из Excel/CSV
- Экспорт любых справочников в Excel/CSV
- Валидация данных при импорте
- Отчёт об ошибках импорта
- Шаблоны для импорта

## 3. Технические требования

### 3.1 Архитектура
- Symfony 7.x (PHP 8.2+)
- PostgreSQL для хранения данных
- Doctrine ORM
- DDD архитектура (Domain/Application/Infrastructure)
- Symfony Messenger для асинхронных задач
- Redis для кэширования

### 3.2 Безопасность
- Ролевая модель: ROLE_ADMIN, ROLE_MANAGER, ROLE_DIRECTOR
- Voters для проверки прав доступа
- CSRF защита
- Двухфакторная аутентификация (2FA)
- Аудит действий пользователей

### 3.3 Производительность
- Кэширование запросов (QueryCacheService)
- Ленивая загрузка данных
- Пагинация списков
- Оптимизация N+1 запросов
- Индексы в БД

### 3.4 UI/UX
- Современный дизайн с градиентами
- Адаптивная вёрстка (mobile-first)
- Темная тема
- Анимации и transitions
- Chart.js для графиков
- Drag-and-drop для виджетов и воронки

### 3.5 Интеграции
- REST API для внешних систем
- Webhook для событий
- OAuth2 для авторизации API
- Rate limiting для API
- Документация API (OpenAPI/Swagger)

## 4. Нефункциональные требования

### 4.1 Производительность
- Время загрузки dashboard < 2 секунд
- Время генерации отчёта < 5 секунд
- Поддержка до 1000 одновременных пользователей

### 4.2 Надёжность
- Доступность системы 99.5%
- Резервное копирование данных (ежедневно)
- Восстановление после сбоя < 1 час

### 4.3 Масштабируемость
- Поддержка до 100 000 клиентов
- Поддержка до 50 000 товаров
- Поддержка до 1 000 000 сделок

### 4.4 Совместимость
- Браузеры: Chrome, Firefox, Safari, Edge (последние 2 версии)
- Мобильные устройства: iOS 14+, Android 10+

## 5. Ограничения и допущения

### 5.1 Ограничения
- Разработка ведётся одним разработчиком
- Срок разработки: в рамках производственной практики
- Бюджет: минимальный (использование open-source решений)

### 5.2 Допущения
- Пользователи имеют базовые навыки работы с веб-приложениями
- Интернет-соединение стабильное
- 1С установлена и настроена на стороне клиента

## 6. Приоритеты реализации

### Высокий приоритет (MVP)
1. Модуль "Продажи и сделки" (US-2.1.1, US-2.1.2)
2. Модуль "Клиенты" (US-2.2.1, US-2.2.2)
3. Расширенный дашборд (US-2.4.1, US-2.4.2)
4. Базовые отчёты (US-2.5.1)

### Средний приоритет
1. Модуль "Товары и склад" (US-2.3.1, US-2.3.2)
2. Планирование продаж (US-2.1.3)
3. Аналитика по клиентам и товарам (US-2.2.3, US-2.3.3)
4. Уведомления (US-2.6.1, US-2.6.2)

### Низкий приоритет
1. Автоматическая рассылка отчётов (US-2.5.2)
2. Настраиваемые правила уведомлений (US-2.6.3)
3. Интеграция с 1С (US-2.7.1)
4. Импорт/экспорт данных (US-2.7.2)

## 7. Критерии успеха

- Все функции высокого приоритета реализованы и протестированы
- Система используется минимум 5 пользователями
- Положительная обратная связь от пользователей
- Документация по использованию системы подготовлена
- Код соответствует стандартам PSR-12
- Покрытие тестами критичных модулей > 70%
